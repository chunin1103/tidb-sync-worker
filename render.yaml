# Render Blueprint for TiDB Unified Service
# Deploy: https://render.com/deploy?repo=YOUR_GITHUB_REPO_URL
#
# Single service providing:
# 1. Sync Worker - scheduled syncs from IDrive to TiDB (6 AM / 6 PM UTC)
# 2. MCP Server - query TiDB from Claude
#
# Endpoints:
# - GET  /         - Health check
# - GET  /status   - Sync status and schedule
# - POST /sync     - Trigger manual sync
# - POST /mcp      - MCP endpoint for Claude
# - GET  /tools    - List MCP tools
# - POST /query    - Direct query (testing)

services:
  - type: web
    name: tidb-unified
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python sync_worker.py
    healthCheckPath: /
    envVars:
      # TiDB Configuration
      - key: TIDB_HOST
        value: gateway01.ap-southeast-1.prod.aws.tidbcloud.com
      - key: TIDB_PORT
        value: "4000"
      - key: TIDB_USER
        sync: false  # Set manually in dashboard
      - key: TIDB_PASSWORD
        sync: false  # Set manually in dashboard (secret)
      - key: TIDB_DATABASE
        value: test
      # IDrive Configuration (for sync)
      - key: IDRIVE_ACCESS_KEY
        sync: false  # Set manually in dashboard
      - key: IDRIVE_SECRET_KEY
        sync: false  # Set manually in dashboard (secret)
      - key: IDRIVE_ENDPOINT
        sync: false  # Set manually in dashboard
      - key: IDRIVE_BUCKET
        value: dbdaily
      # MCP Configuration
      - key: MAX_QUERY_ROWS
        value: "1000"
