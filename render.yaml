# Render Blueprint for Unified TiDB + Agent Garden Service
# Deploy: https://render.com/deploy?repo=YOUR_GITHUB_REPO_URL
#
# Single unified service providing:
# 1. TiDB MCP Server - query TiDB from Claude (root level endpoints)
# 2. Sync Worker - scheduled syncs from IDrive to TiDB
# 3. Agent Garden - autonomous agent management system (/AgentGarden)
#
# Endpoints:
# Root Level (TiDB/Sync):
# - GET  /              - Unified health check
# - POST /mcp           - MCP endpoint for Claude
# - GET  /tools         - List MCP tools
# - POST /query         - Direct query (testing)
# - GET  /status        - Sync status and schedule
# - POST /sync          - Trigger manual sync
#
# Agent Garden (/AgentGarden):
# - GET  /AgentGarden/                - Agent Garden dashboard UI
# - POST /AgentGarden/execute_agent   - Execute agent with SSE streaming
# - GET  /AgentGarden/sessions        - Get active sessions
# - And 30+ more Agent Garden endpoints...

services:
  - type: web
    name: tidb-agent-garden-unified
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python unified_app.py
    healthCheckPath: /
    envVars:
      # TiDB Configuration
      - key: TIDB_HOST
        value: gateway01.ap-southeast-1.prod.aws.tidbcloud.com
      - key: TIDB_PORT
        value: "4000"
      - key: TIDB_USER
        sync: false  # Set manually in dashboard
      - key: TIDB_PASSWORD
        sync: false  # Set manually in dashboard (secret)
      - key: TIDB_DATABASE
        value: test
      # IDrive Configuration (for sync)
      - key: IDRIVE_ACCESS_KEY
        sync: false  # Set manually in dashboard
      - key: IDRIVE_SECRET_KEY
        sync: false  # Set manually in dashboard (secret)
      - key: IDRIVE_ENDPOINT
        sync: false  # Set manually in dashboard
      - key: IDRIVE_BUCKET
        value: dbdaily
      # MCP Configuration
      - key: MAX_QUERY_ROWS
        value: "1000"
      # Agent Garden Configuration
      - key: GOOGLE_API_KEY
        sync: false  # Set manually in dashboard (for AI features)
      - key: REDIS_URL
        sync: false  # Optional: For Celery background tasks
      - key: FLASK_DEBUG
        value: "False"
