<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Garden - AGS Labs</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --glass-bg: rgba(17, 24, 39, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-green: #00ff9d;
            --neon-blue: #00b8ff;
            --neon-purple: #a855f7;
            --neon-red: #ff6b9d;
            --neon-yellow: #ffd700;
            --neon-orange: #ff9500;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --shadow-glow: 0 0 40px rgba(0, 255, 157, 0.15);
            --shadow-glow-blue: 0 0 40px rgba(0, 184, 255, 0.15);
            --shadow-glow-purple: 0 0 40px rgba(168, 85, 247, 0.15);
        }

        body {
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0a0e1a 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Gradient */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 50%, rgba(0, 255, 157, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 184, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(5%, 5%) rotate(120deg); }
            66% { transform: translate(-5%, 5%) rotate(240deg); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }

        h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--neon-green), var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: glow 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            animation: fadeIn 1s ease-out 0.3s both;
        }

        .architecture-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--neon-green);
            border-radius: 50px;
            font-size: 0.875rem;
            color: var(--neon-green);
            animation: fadeIn 1s ease-out 0.5s both;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* System Health Bar */
        .health-bar {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            animation: fadeInUp 0.8s ease-out;
            flex-wrap: wrap;
        }

        .health-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
        }

        .health-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-online {
            background: var(--neon-green);
            box-shadow: 0 0 12px var(--neon-green);
        }

        .status-offline {
            background: var(--neon-red);
            box-shadow: 0 0 12px var(--neon-red);
        }

        .status-warning {
            background: var(--neon-yellow);
            box-shadow: 0 0 12px var(--neon-yellow);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .last-refresh {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Dashboard Panels */
        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out both;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }

        /* Panel Sizes - Adjusted to 7-5 split */
        .panel-analytics {
            grid-column: span 12;
            animation-delay: 0.1s;
            border-color: rgba(255, 149, 0, 0.2);
        }

        .panel-task-queue {
            grid-column: span 7;
            animation-delay: 0.2s;
        }

        .panel-executor {
            grid-column: span 5;
            animation-delay: 0.3s;
            border-color: rgba(0, 184, 255, 0.2);
        }

        .panel-reports {
            grid-column: span 7;
            animation-delay: 0.4s;
            border-color: rgba(168, 85, 247, 0.2);
        }

        .panel-config {
            grid-column: span 5;
            animation-delay: 0.5s;
            border-color: rgba(255, 215, 0, 0.2);
        }

        /* Panel Headers */
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .icon-task-queue {
            background: linear-gradient(135deg, rgba(0, 255, 157, 0.2), rgba(0, 255, 157, 0.05));
            box-shadow: 0 4px 16px rgba(0, 255, 157, 0.2);
        }

        .icon-executor {
            background: linear-gradient(135deg, rgba(0, 184, 255, 0.2), rgba(0, 184, 255, 0.05));
            box-shadow: 0 4px 16px rgba(0, 184, 255, 0.2);
        }

        .icon-reports {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.05));
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.2);
        }

        .icon-config {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.05));
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.2);
        }

        .icon-analytics {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 149, 0, 0.05));
            box-shadow: 0 4px 16px rgba(255, 149, 0, 0.2);
        }

        .panel-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-green);
            color: var(--text-primary);
        }

        .btn-primary {
            background: var(--neon-green);
            color: #0a0e1a;
            border-color: var(--neon-green);
            font-weight: 500;
        }

        .btn-primary:hover {
            background: #00cc7e;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .btn-icon {
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Search & Filter Bar */
        .filter-bar {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--neon-green);
            background: rgba(255, 255, 255, 0.08);
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--neon-green);
        }

        /* Bulk Actions Bar */
        .bulk-actions {
            display: none;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--neon-green);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            align-items: center;
            justify-content: space-between;
        }

        .bulk-actions.active {
            display: flex;
        }

        .bulk-info {
            font-size: 0.875rem;
            color: var(--neon-green);
            font-weight: 500;
        }

        .bulk-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 0.25rem;
        }

        .stat-value.green { color: var(--neon-green); }
        .stat-value.blue { color: var(--neon-blue); }
        .stat-value.purple { color: var(--neon-purple); }
        .stat-value.red { color: var(--neon-red); }
        .stat-value.yellow { color: var(--neon-yellow); }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Task List */
        .task-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 157, 0.3);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 157, 0.5);
        }

        .task-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-item.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.05);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--neon-green);
            transform: translateX(4px);
        }

        .task-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .task-header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .task-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .task-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 215, 0, 0.2);
            color: var(--neon-yellow);
            border: 1px solid var(--neon-yellow);
        }

        .status-in_progress {
            background: rgba(0, 184, 255, 0.2);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            animation: statusPulse 2s ease-in-out infinite;
        }

        .status-completed {
            background: rgba(0, 255, 157, 0.2);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
        }

        .status-failed {
            background: rgba(255, 107, 157, 0.2);
            color: var(--neon-red);
            border: 1px solid var(--neon-red);
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .task-type {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .task-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .task-btn {
            padding: 0.375rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .task-btn.retry:hover { border-color: var(--neon-blue); }
        .task-btn.delete:hover { border-color: var(--neon-red); }
        .task-btn.view:hover { border-color: var(--neon-purple); }

        /* Executor Activity Feed */
        .activity-feed {
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            min-width: 60px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-action {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .activity-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .activity-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 0.5rem;
        }

        .indicator-polling { background: var(--neon-blue); box-shadow: 0 0 8px var(--neon-blue); }
        .indicator-executing { background: var(--neon-yellow); box-shadow: 0 0 8px var(--neon-yellow); animation: pulse 1s ease-in-out infinite; }
        .indicator-completed { background: var(--neon-green); box-shadow: 0 0 8px var(--neon-green); }
        .indicator-failed { background: var(--neon-red); box-shadow: 0 0 8px var(--neon-red); }

        /* Reports Gallery */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-card:hover {
            background: rgba(168, 85, 247, 0.1);
            border-color: var(--neon-purple);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow-purple);
        }

        .report-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .report-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .report-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .report-summary {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Config Form */
        .config-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--neon-green);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(0, 255, 157, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'JetBrains Mono', monospace;
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .cron-preview {
            background: rgba(0, 184, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.75rem;
            color: var(--neon-blue);
            display: none;
        }

        .cron-preview.active {
            display: block;
        }

        .cron-times {
            margin-top: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .page-btn {
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-green);
            color: var(--text-primary);
        }

        .page-btn.active {
            background: var(--neon-green);
            color: #0a0e1a;
            border-color: var(--neon-green);
        }

        .page-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeInUp 0.4s ease-out;
            position: relative;
        }

        .modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 157, 0.3);
            border-radius: 3px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 107, 157, 0.2);
            border-color: var(--neon-red);
            color: var(--neon-red);
        }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
        }

        .modal-data {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-message {
            flex: 1;
            font-size: 0.875rem;
        }

        .toast.success {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.1);
        }

        .toast.error {
            border-color: var(--neon-red);
            background: rgba(255, 107, 157, 0.1);
        }

        .toast.info {
            border-color: var(--neon-blue);
            background: rgba(0, 184, 255, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-text {
            font-size: 0.875rem;
        }

        /* Loading Animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            animation: loadingDot 1.4s ease-in-out infinite;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDot {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Analytics Charts */
        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart {
            width: 100%;
            height: 200px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .panel-task-queue,
            .panel-executor,
            .panel-reports,
            .panel-config,
            .panel-analytics {
                grid-column: span 12;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .panel {
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .health-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .toast-container {
                top: 1rem;
                right: 1rem;
                left: 1rem;
            }

            .toast {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">AGS LABS</div>
            <h1>Agent Garden</h1>
            <p class="subtitle">Gemini-Powered Intelligence Dashboard</p>
            <div class="architecture-badge">
                <span>ü§ñ</span>
                <span>Gemini ‚Üí Task Queue ‚Üí Claude Code CLI</span>
            </div>
        </header>

        <!-- System Health Bar -->
        <div class="health-bar">
            <div class="health-item">
                <div class="health-status status-online" id="status-database"></div>
                <span>Database: <span id="db-status">Checking...</span></span>
            </div>
            <div class="health-item">
                <div class="health-status status-online" id="status-mcp"></div>
                <span>MCP Server: <span id="mcp-status">Checking...</span></span>
            </div>
            <div class="health-item">
                <div class="health-status status-warning" id="status-executor"></div>
                <span>Executor: <span id="executor-status">Unknown</span></span>
            </div>
            <div class="last-refresh">
                Last refresh: <span id="last-refresh">Never</span>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Analytics Panel -->
            <section class="panel panel-analytics">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-analytics">üìà</div>
                        <span>Analytics Dashboard</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value blue" id="analytics-completion-rate">0%</div>
                        <div class="stat-label">Success Rate (7d)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value purple" id="analytics-avg-time">0s</div>
                        <div class="stat-label">Avg Execution Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value green" id="analytics-today">0</div>
                        <div class="stat-label">Tasks Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value yellow" id="analytics-week">0</div>
                        <div class="stat-label">Tasks This Week</div>
                    </div>
                </div>
            </section>

            <!-- Task Queue Panel -->
            <section class="panel panel-task-queue">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-task-queue">üìã</div>
                        <span>Task Queue</span>
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="exportTasks()" title="Export tasks">üíæ</button>
                        <button class="btn" onclick="refreshTasks()">üîÑ Refresh</button>
                    </div>
                </div>

                <!-- Task Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value green" id="stat-total">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value yellow" id="stat-pending">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value blue" id="stat-progress">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value green" id="stat-completed">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value red" id="stat-failed">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                </div>

                <!-- Search & Filter Bar -->
                <div class="filter-bar">
                    <input
                        type="text"
                        class="filter-input"
                        id="searchTasks"
                        placeholder="üîç Search tasks by ID or description..."
                        oninput="filterTasks()"
                    />
                    <select class="filter-select" id="filterStatus" onchange="filterTasks()">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                    </select>
                    <select class="filter-select" id="filterType" onchange="filterTasks()">
                        <option value="">All Types</option>
                        <option value="inventory_intelligence">Inventory Intelligence</option>
                        <option value="sales_analysis">Sales Analysis</option>
                        <option value="customer_insights">Customer Insights</option>
                        <option value="product_performance">Product Performance</option>
                        <option value="general_report">General Report</option>
                    </select>
                </div>

                <!-- Bulk Actions Bar -->
                <div class="bulk-actions" id="bulkActionsBar">
                    <div class="bulk-info">
                        <span id="selectedCount">0</span> tasks selected
                    </div>
                    <div class="bulk-buttons">
                        <button class="btn" onclick="bulkDelete()">üóëÔ∏è Delete</button>
                        <button class="btn" onclick="bulkRetry()">‚ôªÔ∏è Retry</button>
                        <button class="btn" onclick="clearSelection()">‚úñÔ∏è Clear</button>
                    </div>
                </div>

                <!-- Task List -->
                <div class="task-list" id="taskList">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="taskPagination"></div>
            </section>

            <!-- Executor Activity Panel -->
            <section class="panel panel-executor">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-executor">‚ö°</div>
                        <span>Executor Activity</span>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="activity-feed" id="activityFeed">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            </section>

            <!-- Reports Panel -->
            <section class="panel panel-reports">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-reports">üìä</div>
                        <span>Generated Reports</span>
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="exportReports()" title="Export all reports">üì¶</button>
                        <button class="btn" onclick="refreshReports()">üîÑ Refresh</button>
                    </div>
                </div>

                <!-- Reports Grid -->
                <div class="reports-grid" id="reportsGrid">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="reportPagination"></div>
            </section>

            <!-- Config Panel -->
            <section class="panel panel-config">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-config">‚öôÔ∏è</div>
                        <span>Create Task</span>
                    </div>
                </div>

                <!-- Config Form -->
                <form class="config-form" onsubmit="createTask(event)">
                    <div class="form-group">
                        <label class="form-label" for="taskType">Agent Type</label>
                        <select class="form-select" id="taskType" required>
                            <option value="">Select agent type...</option>
                            <option value="inventory_intelligence">üì¶ Inventory Intelligence</option>
                            <option value="sales_analysis">üí∞ Sales Analysis</option>
                            <option value="customer_insights">üë• Customer Insights</option>
                            <option value="product_performance">üìà Product Performance</option>
                            <option value="general_report">üìù General Report</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="taskPrompt">Task Prompt</label>
                        <textarea
                            class="form-textarea"
                            id="taskPrompt"
                            placeholder="Describe what you want Claude to analyze..."
                            required
                        ></textarea>
                        <span class="form-hint">Example: "Analyze sales trends for the last 7 days"</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="scheduleCron">Schedule (Optional)</label>
                        <input
                            class="form-input"
                            type="text"
                            id="scheduleCron"
                            placeholder="0 9 * * *"
                            oninput="validateCron(this.value)"
                        />
                        <span class="form-hint">Cron format: "0 9 * * *" = Daily at 9 AM</span>
                        <div class="cron-preview" id="cronPreview">
                            <div>‚úÖ Valid cron expression</div>
                            <div class="cron-times" id="cronTimes"></div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üöÄ Create Task
                    </button>
                </form>
            </section>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Task Details</div>
                <button class="modal-close" onclick="closeTaskDetailModal()">√ó</button>
            </div>
            <div id="taskDetailContent"></div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div class="modal" id="reportPreviewModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div class="modal-title" id="reportModalTitle">Report Preview</div>
                <button class="modal-close" onclick="closeReportPreviewModal()">√ó</button>
            </div>
            <div id="reportPreviewContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="downloadCurrentReport()">üíæ Download</button>
                <button class="btn" onclick="copyReportContent()">üìã Copy</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allTasks = [];
        let filteredTasks = [];
        let selectedTasks = new Set();
        let currentPage = 1;
        let tasksPerPage = 20;
        let currentReportPath = '';

        // Auto-refresh interval (10 seconds)
        const REFRESH_INTERVAL = 10000;
        let refreshIntervalId = null;

        // Start auto-refresh on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            startAutoRefresh();
            checkNotificationPermission();
        });

        function startAutoRefresh() {
            refreshIntervalId = setInterval(() => {
                loadDashboard();
            }, REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
            }
        }

        // Load complete dashboard data
        async function loadDashboard() {
            await Promise.all([
                loadSystemHealth(),
                loadTasks(),
                loadExecutorActivity(),
                loadReports(),
                loadAnalytics()
            ]);
            updateLastRefreshTime();
        }

        // System Health Check
        async function loadSystemHealth() {
            try {
                // Check database via task endpoint
                const taskResponse = await fetch('/AgentGarden/tasks/list?limit=1');
                const taskData = await taskResponse.json();

                updateHealthStatus('database', taskData.success, taskData.success ? 'Connected' : 'Error');

                // Check MCP server
                const mcpResponse = await fetch('/tools');
                const mcpData = await mcpResponse.json();

                updateHealthStatus('mcp', mcpData && mcpData.length > 0, mcpData ? 'Online' : 'Offline');

                // Check executor (based on recent task activity)
                if (taskData.success && taskData.tasks && taskData.tasks.length > 0) {
                    const recentInProgress = taskData.tasks.some(t => t.status === 'in_progress');
                    const recentCompleted = taskData.tasks.filter(t => t.status === 'completed');

                    if (recentInProgress) {
                        updateHealthStatus('executor', true, 'Running');
                    } else if (recentCompleted.length > 0) {
                        const lastCompleted = new Date(recentCompleted[0].updated_at);
                        const minutesAgo = Math.floor((Date.now() - lastCompleted) / 60000);
                        updateHealthStatus('executor', minutesAgo < 10, minutesAgo < 10 ? 'Active' : `Idle (${minutesAgo}m ago)`);
                    } else {
                        updateHealthStatus('executor', false, 'Unknown');
                    }
                } else {
                    updateHealthStatus('executor', false, 'Unknown');
                }
            } catch (error) {
                console.error('Error checking system health:', error);
            }
        }

        function updateHealthStatus(component, isOnline, statusText) {
            const statusEl = document.getElementById(`status-${component}`);
            const textEl = document.getElementById(`${component}-status`);

            if (statusEl) {
                statusEl.className = 'health-status ' + (isOnline ? 'status-online' : 'status-offline');
            }
            if (textEl) {
                textEl.textContent = statusText;
            }
        }

        function updateLastRefreshTime() {
            const now = new Date();
            document.getElementById('last-refresh').textContent = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // Load tasks from API
        async function loadTasks() {
            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=1000');
                const data = await response.json();

                if (data.success) {
                    allTasks = data.tasks || [];
                    filteredTasks = [...allTasks];

                    // Apply current filters
                    filterTasks();

                    // Update stats
                    updateTaskStats();
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
                showToast('Error loading tasks', 'error');
            }
        }

        function updateTaskStats() {
            const stats = {
                total: allTasks.length,
                pending: allTasks.filter(t => t.status === 'pending').length,
                in_progress: allTasks.filter(t => t.status === 'in_progress').length,
                completed: allTasks.filter(t => t.status === 'completed').length,
                failed: allTasks.filter(t => t.status === 'failed').length
            };

            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-pending').textContent = stats.pending;
            document.getElementById('stat-progress').textContent = stats.in_progress;
            document.getElementById('stat-completed').textContent = stats.completed;
            document.getElementById('stat-failed').textContent = stats.failed;
        }

        function filterTasks() {
            const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterType').value;

            filteredTasks = allTasks.filter(task => {
                const matchesSearch = !searchTerm ||
                    task.id.toString().includes(searchTerm) ||
                    (task.task_json?.description || '').toLowerCase().includes(searchTerm) ||
                    (task.task_json?.prompt || '').toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || task.status === statusFilter;
                const matchesType = !typeFilter || task.task_type === typeFilter;

                return matchesSearch && matchesStatus && matchesType;
            });

            currentPage = 1;
            renderTaskList();
        }

        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            const startIndex = (currentPage - 1) * tasksPerPage;
            const endIndex = startIndex + tasksPerPage;
            const pageTasks = filteredTasks.slice(startIndex, endIndex);

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div class="empty-text">No tasks found matching your filters</div>
                    </div>
                `;
                updatePagination('taskPagination', 0);
                return;
            }

            taskList.innerHTML = pageTasks.map(task => {
                const isSelected = selectedTasks.has(task.id);
                return `
                    <div class="task-item ${isSelected ? 'selected' : ''}" onclick="viewTaskDetails(${task.id})">
                        <div class="task-header">
                            <div class="task-header-left">
                                <input
                                    type="checkbox"
                                    class="task-checkbox"
                                    ${isSelected ? 'checked' : ''}
                                    onclick="event.stopPropagation(); toggleTaskSelection(${task.id})"
                                />
                                <span class="task-id">#${task.id}</span>
                            </div>
                            <span class="task-status status-${task.status}">${task.status.replace('_', ' ')}</span>
                        </div>
                        <div class="task-type">${formatAgentType(task.task_type || 'General Task')}</div>
                        <div class="task-description">${truncate(task.task_json?.description || task.task_json?.prompt || 'No description', 100)}</div>
                        <div class="task-meta">
                            <span>üìÖ ${formatDateTime(task.created_at)}</span>
                            ${task.result_summary ? `<span>üìä Report generated</span>` : ''}
                            ${task.schedule_cron ? `<span>üîÑ Scheduled: ${task.schedule_cron}</span>` : ''}
                        </div>
                        <div class="task-actions" onclick="event.stopPropagation()">
                            <button class="task-btn view" onclick="viewTaskDetails(${task.id})">üëÅÔ∏è View</button>
                            ${task.status === 'failed' || task.status === 'completed' ?
                                `<button class="task-btn retry" onclick="retryTask(${task.id})">‚ôªÔ∏è Retry</button>` : ''}
                            ${task.status === 'pending' ?
                                `<button class="task-btn delete" onclick="deleteTask(${task.id})">‚è∏Ô∏è Cancel</button>` : ''}
                            <button class="task-btn delete" onclick="deleteTask(${task.id})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            }).join('');

            updatePagination('taskPagination', filteredTasks.length);
            updateBulkActionsBar();
        }

        function toggleTaskSelection(taskId) {
            if (selectedTasks.has(taskId)) {
                selectedTasks.delete(taskId);
            } else {
                selectedTasks.add(taskId);
            }
            renderTaskList();
        }

        function updateBulkActionsBar() {
            const bar = document.getElementById('bulkActionsBar');
            const count = document.getElementById('selectedCount');

            count.textContent = selectedTasks.size;

            if (selectedTasks.size > 0) {
                bar.classList.add('active');
            } else {
                bar.classList.remove('active');
            }
        }

        function clearSelection() {
            selectedTasks.clear();
            renderTaskList();
        }

        async function bulkDelete() {
            if (!confirm(`Delete ${selectedTasks.size} selected tasks?`)) return;

            const promises = Array.from(selectedTasks).map(id => deleteTask(id, false));
            await Promise.all(promises);

            selectedTasks.clear();
            showToast('Tasks deleted successfully', 'success');
            loadTasks();
        }

        async function bulkRetry() {
            const promises = Array.from(selectedTasks).map(id => retryTask(id, false));
            await Promise.all(promises);

            selectedTasks.clear();
            showToast('Tasks queued for retry', 'success');
            loadTasks();
        }

        function updatePagination(containerId, totalItems) {
            const container = document.getElementById(containerId);
            const totalPages = Math.ceil(totalItems / tasksPerPage);

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = `
                <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}"
                        onclick="changePage(${currentPage - 1})"
                        ${currentPage === 1 ? 'disabled' : ''}>
                    ‚Üê Prev
                </button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}"
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span style="padding: 0.5rem;">...</span>`;
                }
            }

            html += `
                <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}"
                        onclick="changePage(${currentPage + 1})"
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    Next ‚Üí
                </button>
            `;

            container.innerHTML = html;
        }

        function changePage(page) {
            currentPage = page;
            renderTaskList();
        }

        // View task details in modal
        function viewTaskDetails(taskId) {
            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;

            const content = `
                <div class="modal-section">
                    <div class="modal-section-title">Task Information</div>
                    <div class="modal-data">Task ID: #${task.id}
Status: ${task.status}
Type: ${task.task_type || 'General'}
Created: ${formatDateTime(task.created_at)}
Updated: ${formatDateTime(task.updated_at)}
Created By: ${task.created_by || 'Unknown'}
${task.schedule_cron ? 'Schedule: ' + task.schedule_cron : ''}</div>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">Task Prompt</div>
                    <div class="modal-data">${task.task_json?.prompt || task.task_json?.description || 'No prompt provided'}</div>
                </div>

                ${task.result_summary ? `
                <div class="modal-section">
                    <div class="modal-section-title">Result Summary</div>
                    <div class="modal-data">${task.result_summary}</div>
                </div>
                ` : ''}

                ${task.result_path ? `
                <div class="modal-section">
                    <div class="modal-section-title">Report Path</div>
                    <div class="modal-data">${task.result_path}</div>
                </div>
                ` : ''}

                ${task.error_log ? `
                <div class="modal-section">
                    <div class="modal-section-title">Error Log</div>
                    <div class="modal-data" style="color: var(--neon-red);">${task.error_log}</div>
                </div>
                ` : ''}

                <div class="modal-section">
                    <div class="modal-section-title">Full Task JSON</div>
                    <div class="modal-data">${JSON.stringify(task.task_json, null, 2)}</div>
                </div>

                <div class="modal-buttons">
                    ${task.status === 'failed' || task.status === 'completed' ?
                        `<button class="btn btn-primary" onclick="retryTask(${task.id}); closeTaskDetailModal();">‚ôªÔ∏è Retry Task</button>` : ''}
                    <button class="btn" onclick="deleteTask(${task.id}); closeTaskDetailModal();">üóëÔ∏è Delete Task</button>
                    <button class="btn" onclick="closeTaskDetailModal()">Close</button>
                </div>
            `;

            document.getElementById('taskDetailContent').innerHTML = content;
            document.getElementById('taskDetailModal').classList.add('active');
        }

        function closeTaskDetailModal() {
            document.getElementById('taskDetailModal').classList.remove('active');
        }

        async function retryTask(taskId, showNotification = true) {
            try {
                const task = allTasks.find(t => t.id === taskId);
                if (!task) return;

                // Create new task with same parameters
                const payload = {
                    task_type: task.task_type,
                    task_json: task.task_json,
                    created_by: 'retry'
                };

                if (task.schedule_cron) {
                    payload.schedule_cron = task.schedule_cron;
                }

                const response = await fetch('/AgentGarden/tasks/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success && showNotification) {
                    showToast(`Task #${result.task_id} created (retry of #${taskId})`, 'success');
                    loadTasks();
                }
            } catch (error) {
                console.error('Error retrying task:', error);
                if (showNotification) {
                    showToast('Failed to retry task', 'error');
                }
            }
        }

        async function deleteTask(taskId, showNotification = true) {
            // Note: Backend endpoint for task deletion not implemented yet
            // This would need to be added to unified_app.py
            if (showNotification) {
                showToast('Delete endpoint not yet implemented', 'info');
            }
            console.log('Delete task:', taskId);
        }

        // Load executor activity
        async function loadExecutorActivity() {
            const activityFeed = document.getElementById('activityFeed');

            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=15');
                const data = await response.json();

                if (data.success && data.tasks && data.tasks.length > 0) {
                    const activities = data.tasks.map(task => {
                        const time = new Date(task.updated_at || task.created_at);
                        const timeStr = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                        let action = 'Task created';
                        let indicator = 'polling';

                        if (task.status === 'in_progress') {
                            action = 'Executing task';
                            indicator = 'executing';
                        } else if (task.status === 'completed') {
                            action = 'Task completed';
                            indicator = 'completed';
                        } else if (task.status === 'failed') {
                            action = 'Task failed';
                            indicator = 'failed';
                        }

                        return `
                            <div class="activity-item">
                                <div class="activity-indicator indicator-${indicator}"></div>
                                <div class="activity-time">${timeStr}</div>
                                <div class="activity-content">
                                    <div class="activity-action">${action}</div>
                                    <div class="activity-details">Task #${task.id}: ${formatAgentType(task.task_type || 'General')}</div>
                                </div>
                            </div>
                        `;
                    });

                    activityFeed.innerHTML = activities.join('');
                } else {
                    activityFeed.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üí§</div>
                            <div class="empty-text">No recent executor activity</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }

        // Load reports from API
        async function loadReports() {
            const reportsGrid = document.getElementById('reportsGrid');

            try {
                const response = await fetch('/AgentGarden/api/reports/list?limit=50');
                const data = await response.json();

                if (data.success) {
                    const reports = data.reports || [];

                    if (reports.length === 0) {
                        reportsGrid.innerHTML = `
                            <div class="empty-state" style="grid-column: 1 / -1;">
                                <div class="empty-icon">üìä</div>
                                <div class="empty-text">No reports yet. Claude will generate reports here once tasks are completed.</div>
                            </div>
                        `;
                    } else {
                        reportsGrid.innerHTML = reports.map(report => {
                            const agentEmojis = {
                                'inventory_intelligence': 'üì¶',
                                'sales_analysis': 'üí∞',
                                'customer_insights': 'üë•',
                                'product_performance': 'üìà',
                                'general_report': 'üìù',
                                'unknown': 'üìÑ'
                            };

                            const emoji = agentEmojis[report.agent_type] || 'üìÑ';
                            const sizeKB = (report.size / 1024).toFixed(1);

                            return `
                                <div class="report-card" onclick="viewReportPreview('${report.path}', '${report.title}')">
                                    <div class="report-icon">${emoji}</div>
                                    <div class="report-title">${report.title}</div>
                                    <div class="report-meta">
                                        <span>${formatDateTime(report.created_at)}</span>
                                        <span>${sizeKB} KB</span>
                                    </div>
                                    <div class="report-summary">${report.summary || 'No summary available'}</div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        // View report preview in modal
        async function viewReportPreview(reportPath, reportTitle) {
            try {
                currentReportPath = reportPath;

                const response = await fetch(`/AgentGarden/api/reports/view/${reportPath}`);
                const markdown = await response.text();

                document.getElementById('reportModalTitle').textContent = reportTitle;
                document.getElementById('reportPreviewContent').innerHTML = `
                    <div class="modal-data" style="max-height: 500px; white-space: pre-wrap;">${markdown}</div>
                `;
                document.getElementById('reportPreviewModal').classList.add('active');
            } catch (error) {
                console.error('Error loading report:', error);
                showToast('Failed to load report', 'error');
            }
        }

        function closeReportPreviewModal() {
            document.getElementById('reportPreviewModal').classList.remove('active');
        }

        function downloadCurrentReport() {
            if (!currentReportPath) return;
            window.open(`/AgentGarden/api/reports/view/${currentReportPath}`, '_blank');
        }

        function copyReportContent() {
            const content = document.getElementById('reportPreviewContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                showToast('Report content copied to clipboard', 'success');
            });
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=1000');
                const data = await response.json();

                if (data.success) {
                    const tasks = data.tasks || [];

                    // Last 7 days tasks
                    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    const last7Days = tasks.filter(t => new Date(t.created_at) > sevenDaysAgo);

                    const completed7d = last7Days.filter(t => t.status === 'completed').length;
                    const total7d = last7Days.length;
                    const successRate = total7d > 0 ? Math.round((completed7d / total7d) * 100) : 0;

                    document.getElementById('analytics-completion-rate').textContent = successRate + '%';

                    // Average execution time (mock data - would need started_at/completed_at in DB)
                    document.getElementById('analytics-avg-time').textContent = '45s';

                    // Tasks today
                    const today = new Date().toDateString();
                    const tasksToday = tasks.filter(t => new Date(t.created_at).toDateString() === today).length;
                    document.getElementById('analytics-today').textContent = tasksToday;

                    // Tasks this week
                    const weekStart = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    const tasksWeek = tasks.filter(t => new Date(t.created_at) > weekStart).length;
                    document.getElementById('analytics-week').textContent = tasksWeek;
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Create new task via form
        async function createTask(event) {
            event.preventDefault();

            const taskType = document.getElementById('taskType').value;
            const taskPrompt = document.getElementById('taskPrompt').value;
            const scheduleCron = document.getElementById('scheduleCron').value;

            const payload = {
                task_type: taskType,
                task_json: {
                    agent_type: taskType,
                    prompt: taskPrompt,
                    description: taskPrompt
                },
                created_by: 'dashboard'
            };

            if (scheduleCron.trim()) {
                payload.schedule_cron = scheduleCron.trim();
            }

            try {
                const response = await fetch('/AgentGarden/tasks/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`Task #${result.task_id} created successfully!`, 'success');

                    // Reset form
                    document.getElementById('taskType').value = '';
                    document.getElementById('taskPrompt').value = '';
                    document.getElementById('scheduleCron').value = '';
                    document.getElementById('cronPreview').classList.remove('active');

                    // Refresh tasks
                    loadTasks();
                } else {
                    showToast(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error creating task:', error);
                showToast('Failed to create task', 'error');
            }
        }

        // Cron validation (simplified)
        function validateCron(cronExpression) {
            const preview = document.getElementById('cronPreview');
            const timesDiv = document.getElementById('cronTimes');

            if (!cronExpression.trim()) {
                preview.classList.remove('active');
                return;
            }

            // Basic validation (5 fields)
            const parts = cronExpression.trim().split(/\s+/);
            if (parts.length === 5) {
                preview.classList.add('active');

                // Simple interpretation (would need proper library for accurate times)
                let interpretation = '';
                if (cronExpression === '0 9 * * *') interpretation = 'Daily at 9:00 AM';
                else if (cronExpression === '0 * * * *') interpretation = 'Every hour';
                else if (cronExpression === '0 0 * * 0') interpretation = 'Weekly on Sunday at midnight';
                else interpretation = 'Custom schedule';

                timesDiv.innerHTML = `Schedule: ${interpretation}`;
            } else {
                preview.classList.remove('active');
            }
        }

        // Export functions
        function exportTasks() {
            const csv = convertTasksToCSV(allTasks);
            downloadCSV(csv, 'tasks-export.csv');
            showToast('Tasks exported to CSV', 'success');
        }

        function convertTasksToCSV(tasks) {
            const headers = ['ID', 'Status', 'Type', 'Description', 'Created', 'Updated', 'Schedule'];
            const rows = tasks.map(t => [
                t.id,
                t.status,
                t.task_type || 'General',
                (t.task_json?.description || t.task_json?.prompt || '').replace(/"/g, '""'),
                t.created_at,
                t.updated_at,
                t.schedule_cron || ''
            ]);

            return [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportReports() {
            showToast('Export all reports feature coming soon', 'info');
        }

        // Notifications
        function checkNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                // Don't auto-request, wait for user action
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || '‚ÑπÔ∏è'}</div>
                <div class="toast-message">${message}</div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Refresh functions
        function refreshTasks() {
            loadTasks();
            showToast('Tasks refreshed', 'info');
        }

        function refreshReports() {
            loadReports();
            showToast('Reports refreshed', 'info');
        }

        // Utility functions
        function formatDateTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function truncate(str, maxLength) {
            if (!str) return '';
            return str.length > maxLength ? str.substring(0, maxLength) + '...' : str;
        }

        function formatAgentType(type) {
            const emojis = {
                'inventory_intelligence': 'üì¶',
                'sales_analysis': 'üí∞',
                'customer_insights': 'üë•',
                'product_performance': 'üìà',
                'general_report': 'üìù'
            };
            const emoji = emojis[type] || 'üìù';
            const formatted = type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            return `${emoji} ${formatted}`;
        }
    </script>
</body>
</html>
