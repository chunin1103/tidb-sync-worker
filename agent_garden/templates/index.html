<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Garden - AGS Labs</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --glass-bg: rgba(17, 24, 39, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-green: #00ff9d;
            --neon-blue: #00b8ff;
            --neon-purple: #a855f7;
            --neon-red: #ff6b9d;
            --neon-yellow: #ffd700;
            --neon-orange: #ff9500;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --shadow-glow: 0 0 40px rgba(0, 255, 157, 0.15);
            --shadow-glow-blue: 0 0 40px rgba(0, 184, 255, 0.15);
            --shadow-glow-purple: 0 0 40px rgba(168, 85, 247, 0.15);
        }

        body {
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0a0e1a 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Gradient */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 50%, rgba(0, 255, 157, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 184, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(5%, 5%) rotate(120deg); }
            66% { transform: translate(-5%, 5%) rotate(240deg); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }

        h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--neon-green), var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: glow 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            animation: fadeIn 1s ease-out 0.3s both;
        }

        .architecture-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--neon-green);
            border-radius: 50px;
            font-size: 0.875rem;
            color: var(--neon-green);
            animation: fadeIn 1s ease-out 0.5s both;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* System Health Bar */
        .health-bar {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            animation: fadeInUp 0.8s ease-out;
            flex-wrap: wrap;
        }

        .health-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
        }

        .health-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-online {
            background: var(--neon-green);
            box-shadow: 0 0 12px var(--neon-green);
        }

        .status-offline {
            background: var(--neon-red);
            box-shadow: 0 0 12px var(--neon-red);
        }

        .status-warning {
            background: var(--neon-yellow);
            box-shadow: 0 0 12px var(--neon-yellow);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .last-refresh {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Dashboard Panels */
        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out both;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }

        /* Panel Sizes - Adjusted to 7-5 split */
        .panel-analytics {
            grid-column: span 12;
            animation-delay: 0.1s;
            border-color: rgba(255, 149, 0, 0.2);
        }

        .panel-task-queue {
            grid-column: span 7;
            animation-delay: 0.2s;
        }

        .panel-executor {
            grid-column: span 5;
            animation-delay: 0.3s;
            border-color: rgba(0, 184, 255, 0.2);
        }

        .panel-reports {
            grid-column: span 7;
            animation-delay: 0.4s;
            border-color: rgba(168, 85, 247, 0.2);
        }

        .panel-config {
            grid-column: span 5;
            animation-delay: 0.5s;
            border-color: rgba(255, 215, 0, 0.2);
        }

        /* Panel Headers */
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .icon-task-queue {
            background: linear-gradient(135deg, rgba(0, 255, 157, 0.2), rgba(0, 255, 157, 0.05));
            box-shadow: 0 4px 16px rgba(0, 255, 157, 0.2);
        }

        .icon-executor {
            background: linear-gradient(135deg, rgba(0, 184, 255, 0.2), rgba(0, 184, 255, 0.05));
            box-shadow: 0 4px 16px rgba(0, 184, 255, 0.2);
        }

        .icon-reports {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.05));
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.2);
        }

        .icon-config {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.05));
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.2);
        }

        .icon-analytics {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 149, 0, 0.05));
            box-shadow: 0 4px 16px rgba(255, 149, 0, 0.2);
        }

        .panel-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-green);
            color: var(--text-primary);
        }

        .btn-primary {
            background: var(--neon-green);
            color: #0a0e1a;
            border-color: var(--neon-green);
            font-weight: 500;
        }

        .btn-primary:hover {
            background: #00cc7e;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .btn-icon {
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Search & Filter Bar */
        .filter-bar {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--neon-green);
            background: rgba(255, 255, 255, 0.08);
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--neon-green);
        }

        /* Bulk Actions Bar */
        .bulk-actions {
            display: none;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--neon-green);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            align-items: center;
            justify-content: space-between;
        }

        .bulk-actions.active {
            display: flex;
        }

        .bulk-info {
            font-size: 0.875rem;
            color: var(--neon-green);
            font-weight: 500;
        }

        .bulk-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 0.25rem;
        }

        .stat-value.green { color: var(--neon-green); }
        .stat-value.blue { color: var(--neon-blue); }
        .stat-value.purple { color: var(--neon-purple); }
        .stat-value.red { color: var(--neon-red); }
        .stat-value.yellow { color: var(--neon-yellow); }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Task List */
        .task-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 157, 0.3);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 157, 0.5);
        }

        .task-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-item.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.05);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--neon-green);
            transform: translateX(4px);
        }

        .task-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .task-header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .task-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .task-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 215, 0, 0.2);
            color: var(--neon-yellow);
            border: 1px solid var(--neon-yellow);
        }

        .status-in_progress {
            background: rgba(0, 184, 255, 0.2);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            animation: statusPulse 2s ease-in-out infinite;
        }

        .status-completed {
            background: rgba(0, 255, 157, 0.2);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
        }

        .status-failed {
            background: rgba(255, 107, 157, 0.2);
            color: var(--neon-red);
            border: 1px solid var(--neon-red);
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .task-type {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .task-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .task-btn {
            padding: 0.375rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .task-btn.retry:hover { border-color: var(--neon-blue); }
        .task-btn.delete:hover { border-color: var(--neon-red); }
        .task-btn.view:hover { border-color: var(--neon-purple); }

        /* Executor Activity Feed */
        .activity-feed {
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            min-width: 60px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-action {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .activity-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .activity-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 0.5rem;
        }

        .indicator-polling { background: var(--neon-blue); box-shadow: 0 0 8px var(--neon-blue); }
        .indicator-executing { background: var(--neon-yellow); box-shadow: 0 0 8px var(--neon-yellow); animation: pulse 1s ease-in-out infinite; }
        .indicator-completed { background: var(--neon-green); box-shadow: 0 0 8px var(--neon-green); }
        .indicator-failed { background: var(--neon-red); box-shadow: 0 0 8px var(--neon-red); }

        /* Reports Gallery */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-card:hover {
            background: rgba(168, 85, 247, 0.1);
            border-color: var(--neon-purple);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow-purple);
        }

        .report-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .report-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .report-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .report-summary {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Config Form */
        .config-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--neon-green);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(0, 255, 157, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'JetBrains Mono', monospace;
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .cron-preview {
            background: rgba(0, 184, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.75rem;
            color: var(--neon-blue);
            display: none;
        }

        .cron-preview.active {
            display: block;
        }

        .cron-times {
            margin-top: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Schedule Presets */
        .schedule-presets {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .schedule-preset {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.6rem 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 65px;
        }

        .schedule-preset:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .schedule-preset.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.2);
        }

        .schedule-preset .preset-icon {
            font-size: 1.25rem;
        }

        .schedule-preset .preset-label {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .schedule-preset.selected .preset-label {
            color: var(--neon-green);
        }

        /* Schedule Time Picker */
        .schedule-time-picker {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-picker-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .time-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .time-select {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-select:hover {
            border-color: var(--neon-blue);
        }

        .time-select:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 0 2px rgba(0, 255, 157, 0.15);
        }

        .time-separator {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: bold;
        }

        .time-ampm {
            min-width: 55px;
        }

        /* Schedule Day Picker */
        .schedule-day-picker {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-picker-row {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.6rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .day-checkbox:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .day-checkbox:has(input:checked) {
            background: rgba(0, 255, 157, 0.15);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .day-checkbox input {
            accent-color: var(--neon-green);
            cursor: pointer;
        }

        /* Schedule Custom Input */
        .schedule-custom-input {
            margin-top: 0.75rem;
        }

        /* Schedule Preview */
        .schedule-preview {
            margin-top: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--neon-green);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .schedule-preview .preview-icon {
            font-size: 1rem;
        }

        .schedule-preview .preview-text {
            font-size: 0.85rem;
            color: var(--neon-green);
            font-weight: 500;
        }

        /* Format Picker */
        .format-picker {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .format-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        .format-option:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .format-option.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.2);
        }

        .format-option .format-icon {
            font-size: 1.5rem;
        }

        .format-option .format-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .format-option.selected .format-label {
            color: var(--neon-green);
        }

        /* Format-specific colors */
        .format-option[data-format="md"].selected {
            border-color: #9ca3af;
            background: rgba(156, 163, 175, 0.1);
            box-shadow: 0 0 20px rgba(156, 163, 175, 0.2);
        }
        .format-option[data-format="md"].selected .format-label { color: #9ca3af; }

        .format-option[data-format="csv"].selected {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }
        .format-option[data-format="csv"].selected .format-label { color: #22c55e; }

        .format-option[data-format="xlsx"].selected {
            border-color: #16a34a;
            background: rgba(22, 163, 74, 0.1);
            box-shadow: 0 0 20px rgba(22, 163, 74, 0.2);
        }
        .format-option[data-format="xlsx"].selected .format-label { color: #16a34a; }

        .format-option[data-format="json"].selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
        }
        .format-option[data-format="json"].selected .format-label { color: #f59e0b; }

        .format-option[data-format="pdf"].selected {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }
        .format-option[data-format="pdf"].selected .format-label { color: #ef4444; }

        /* Priority Picker */
        .priority-picker {
            display: flex;
            gap: 0.75rem;
        }

        .priority-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .priority-option:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .priority-option.selected {
            border-color: var(--neon-blue);
            background: rgba(0, 184, 255, 0.1);
        }

        .priority-option[data-priority="low"].selected {
            border-color: #6b7280;
            background: rgba(107, 114, 128, 0.1);
        }

        .priority-option[data-priority="normal"].selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .priority-option[data-priority="high"].selected {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Form Row for side-by-side elements */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .format-picker {
                justify-content: center;
            }
        }

        /* Report Format Badge */
        .report-format-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .report-format-badge.format-md {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }

        .report-format-badge.format-csv {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .report-format-badge.format-xlsx {
            background: rgba(22, 163, 74, 0.2);
            color: #16a34a;
        }

        .report-format-badge.format-json {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .report-format-badge.format-pdf {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Auto-refresh Badge */
        .auto-refresh-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.2rem 0.6rem;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--neon-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 0.75rem;
        }

        .pulse-dot {
            width: 6px;
            height: 6px;
            background: var(--neon-green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .page-btn {
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-green);
            color: var(--text-primary);
        }

        .page-btn.active {
            background: var(--neon-green);
            color: #0a0e1a;
            border-color: var(--neon-green);
        }

        .page-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeInUp 0.4s ease-out;
            position: relative;
        }

        .modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 157, 0.3);
            border-radius: 3px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 107, 157, 0.2);
            border-color: var(--neon-red);
            color: var(--neon-red);
        }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
        }

        .modal-data {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-message {
            flex: 1;
            font-size: 0.875rem;
        }

        .toast.success {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.1);
        }

        .toast.error {
            border-color: var(--neon-red);
            background: rgba(255, 107, 157, 0.1);
        }

        .toast.info {
            border-color: var(--neon-blue);
            background: rgba(0, 184, 255, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-text {
            font-size: 0.875rem;
        }

        /* Loading Animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            animation: loadingDot 1.4s ease-in-out infinite;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDot {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Analytics Charts */
        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart {
            width: 100%;
            height: 200px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .panel-task-queue,
            .panel-executor,
            .panel-reports,
            .panel-config,
            .panel-analytics {
                grid-column: span 12;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .panel {
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .health-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .toast-container {
                top: 1rem;
                right: 1rem;
                left: 1rem;
            }

            .toast {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">AGS LABS</div>
            <h1>Agent Garden</h1>
            <p class="subtitle">Gemini-Powered Intelligence Dashboard</p>
            <div class="architecture-badge">
                <span>ðŸ¤–</span>
                <span>Gemini â†’ Task Queue â†’ Claude Code CLI</span>
            </div>
        </header>

        <!-- System Health Bar -->
        <div class="health-bar">
            <div class="health-item">
                <div class="health-status status-online" id="status-database"></div>
                <span>Database: <span id="db-status">Checking...</span></span>
            </div>
            <div class="health-item">
                <div class="health-status status-online" id="status-mcp"></div>
                <span>MCP Server: <span id="mcp-status">Checking...</span></span>
            </div>
            <div class="health-item">
                <div class="health-status status-warning" id="status-executor"></div>
                <span>Executor: <span id="executor-status">Unknown</span></span>
            </div>
            <div class="last-refresh">
                Last refresh: <span id="last-refresh">Never</span>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Analytics Panel -->
            <section class="panel panel-analytics">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-analytics">ðŸ“ˆ</div>
                        <span>Analytics Dashboard</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value blue" id="analytics-completion-rate">0%</div>
                        <div class="stat-label">Success Rate (7d)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value purple" id="analytics-avg-time">0s</div>
                        <div class="stat-label">Avg Execution Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value green" id="analytics-today">0</div>
                        <div class="stat-label">Tasks Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value yellow" id="analytics-week">0</div>
                        <div class="stat-label">Tasks This Week</div>
                    </div>
                </div>
            </section>

            <!-- Task Queue Panel -->
            <section class="panel panel-task-queue">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-task-queue">ðŸ“‹</div>
                        <span>Task Queue</span>
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="exportTasks()" title="Export tasks">ðŸ’¾</button>
                        <button class="btn" onclick="refreshTasks()">ðŸ”„ Refresh</button>
                    </div>
                </div>

                <!-- Task Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value green" id="stat-total">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value yellow" id="stat-pending">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value blue" id="stat-progress">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value green" id="stat-completed">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value red" id="stat-failed">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                </div>

                <!-- Search & Filter Bar -->
                <div class="filter-bar">
                    <input
                        type="text"
                        class="filter-input"
                        id="searchTasks"
                        placeholder="ðŸ” Search tasks by ID or description..."
                        oninput="filterTasks()"
                    />
                    <select class="filter-select" id="filterStatus" onchange="filterTasks()">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                    </select>
                    <select class="filter-select" id="filterType" onchange="filterTasks()">
                        <option value="">All Types</option>
                        <option value="inventory_intelligence">Inventory Intelligence</option>
                        <option value="sales_analysis">Sales Analysis</option>
                        <option value="customer_insights">Customer Insights</option>
                        <option value="product_performance">Product Performance</option>
                        <option value="general_report">General Report</option>
                    </select>
                </div>

                <!-- Bulk Actions Bar -->
                <div class="bulk-actions" id="bulkActionsBar">
                    <div class="bulk-info">
                        <span id="selectedCount">0</span> tasks selected
                    </div>
                    <div class="bulk-buttons">
                        <button class="btn" onclick="bulkDelete()">ðŸ—‘ï¸ Delete</button>
                        <button class="btn" onclick="bulkRetry()">â™»ï¸ Retry</button>
                        <button class="btn" onclick="clearSelection()">âœ–ï¸ Clear</button>
                    </div>
                </div>

                <!-- Task List -->
                <div class="task-list" id="taskList">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="taskPagination"></div>
            </section>

            <!-- Executor Activity Panel -->
            <section class="panel panel-executor">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-executor">âš¡</div>
                        <span>Executor Activity</span>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="activity-feed" id="activityFeed">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            </section>

            <!-- Reports Panel -->
            <section class="panel panel-reports">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-reports">ðŸ“Š</div>
                        <span>Generated Reports</span>
                        <span id="reportsAutoRefresh" class="auto-refresh-badge" title="Auto-refreshes with dashboard">
                            <span class="pulse-dot"></span> Live
                        </span>
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="exportReports()" title="Export all reports">ðŸ“¦</button>
                        <button class="btn" onclick="refreshReports()">ðŸ”„ Refresh</button>
                    </div>
                </div>

                <!-- Reports Grid -->
                <div class="reports-grid" id="reportsGrid">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="reportPagination"></div>
            </section>

            <!-- Config Panel -->
            <section class="panel panel-config">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="panel-icon icon-config">âš™ï¸</div>
                        <span>Create Task</span>
                    </div>
                </div>

                <!-- Config Form -->
                <form class="config-form" onsubmit="createTask(event)">
                    <div class="form-group">
                        <label class="form-label" for="taskType">Agent Type</label>
                        <select class="form-select" id="taskType" required>
                            <option value="">Select agent type...</option>
                            <option value="inventory_intelligence">ðŸ“¦ Inventory Intelligence</option>
                            <option value="sales_analysis">ðŸ’° Sales Analysis</option>
                            <option value="customer_insights">ðŸ‘¥ Customer Insights</option>
                            <option value="product_performance">ðŸ“ˆ Product Performance</option>
                            <option value="general_report">ðŸ“ General Report</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="taskPrompt">Task Prompt</label>
                        <textarea
                            class="form-textarea"
                            id="taskPrompt"
                            placeholder="Describe what you want Claude to analyze..."
                            required
                        ></textarea>
                        <span class="form-hint">Example: "Analyze sales trends for the last 7 days"</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Output Format</label>
                        <div class="format-picker" id="formatPicker">
                            <div class="format-option selected" data-format="md" onclick="selectFormat('md')">
                                <span class="format-icon">ðŸ“„</span>
                                <span class="format-label">Markdown</span>
                            </div>
                            <div class="format-option" data-format="csv" onclick="selectFormat('csv')">
                                <span class="format-icon">ðŸ“Š</span>
                                <span class="format-label">CSV</span>
                            </div>
                            <div class="format-option" data-format="xlsx" onclick="selectFormat('xlsx')">
                                <span class="format-icon">ðŸ“‘</span>
                                <span class="format-label">Excel</span>
                            </div>
                            <div class="format-option" data-format="json" onclick="selectFormat('json')">
                                <span class="format-icon">ðŸ—‚ï¸</span>
                                <span class="format-label">JSON</span>
                            </div>
                            <div class="format-option" data-format="pdf" onclick="selectFormat('pdf')">
                                <span class="format-icon">ðŸ“•</span>
                                <span class="format-label">PDF</span>
                            </div>
                        </div>
                        <input type="hidden" id="outputFormat" value="md">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Schedule (Optional)</label>

                        <!-- Schedule Preset Buttons -->
                        <div class="schedule-presets" id="schedulePresets">
                            <div class="schedule-preset selected" data-schedule="" onclick="selectSchedulePreset('')">
                                <span class="preset-icon">âš¡</span>
                                <span class="preset-label">Run Once</span>
                            </div>
                            <div class="schedule-preset" data-schedule="daily" onclick="selectSchedulePreset('daily')">
                                <span class="preset-icon">â˜€ï¸</span>
                                <span class="preset-label">Daily</span>
                            </div>
                            <div class="schedule-preset" data-schedule="weekly" onclick="selectSchedulePreset('weekly')">
                                <span class="preset-icon">ðŸ“…</span>
                                <span class="preset-label">Weekly</span>
                            </div>
                            <div class="schedule-preset" data-schedule="hourly" onclick="selectSchedulePreset('hourly')">
                                <span class="preset-icon">â°</span>
                                <span class="preset-label">Hourly</span>
                            </div>
                            <div class="schedule-preset" data-schedule="custom" onclick="selectSchedulePreset('custom')">
                                <span class="preset-icon">âš™ï¸</span>
                                <span class="preset-label">Custom</span>
                            </div>
                        </div>

                        <!-- Time Picker (shown for daily/weekly) -->
                        <div class="schedule-time-picker" id="scheduleTimePicker" style="display: none;">
                            <div class="time-picker-row">
                                <label class="time-label">Time:</label>
                                <select class="time-select" id="scheduleHour" onchange="updateSchedulePreview()">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9" selected>9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                                <span class="time-separator">:</span>
                                <select class="time-select" id="scheduleMinute" onchange="updateSchedulePreview()">
                                    <option value="0" selected>00</option>
                                    <option value="15">15</option>
                                    <option value="30">30</option>
                                    <option value="45">45</option>
                                </select>
                                <select class="time-select time-ampm" id="scheduleAmPm" onchange="updateSchedulePreview()">
                                    <option value="AM" selected>AM</option>
                                    <option value="PM">PM</option>
                                </select>
                            </div>
                        </div>

                        <!-- Day Picker (shown for weekly) -->
                        <div class="schedule-day-picker" id="scheduleDayPicker" style="display: none;">
                            <label class="time-label">Repeat on:</label>
                            <div class="day-picker-row">
                                <label class="day-checkbox">
                                    <input type="checkbox" value="1" onchange="updateSchedulePreview()"> Mon
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="2" onchange="updateSchedulePreview()"> Tue
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="3" onchange="updateSchedulePreview()"> Wed
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="4" onchange="updateSchedulePreview()"> Thu
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="5" onchange="updateSchedulePreview()"> Fri
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="6" onchange="updateSchedulePreview()"> Sat
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" value="0" onchange="updateSchedulePreview()"> Sun
                                </label>
                            </div>
                        </div>

                        <!-- Custom Cron Input (shown for custom) -->
                        <div class="schedule-custom-input" id="scheduleCustomInput" style="display: none;">
                            <input
                                class="form-input"
                                type="text"
                                id="scheduleCronCustom"
                                placeholder="0 9 * * *"
                                oninput="updateSchedulePreview()"
                            />
                            <span class="form-hint">Cron format: minute hour day month weekday</span>
                        </div>

                        <!-- Hidden field for actual cron value -->
                        <input type="hidden" id="scheduleCron" value="">

                        <!-- Schedule Preview -->
                        <div class="schedule-preview" id="schedulePreview" style="display: none;">
                            <span class="preview-icon">ðŸ“‹</span>
                            <span class="preview-text" id="schedulePreviewText"></span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        ðŸš€ Create Task
                    </button>
                </form>
            </section>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Task Details</div>
                <button class="modal-close" onclick="closeTaskDetailModal()">Ã—</button>
            </div>
            <div id="taskDetailContent"></div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div class="modal" id="reportPreviewModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div class="modal-title" id="reportModalTitle">Report Preview</div>
                <button class="modal-close" onclick="closeReportPreviewModal()">Ã—</button>
            </div>
            <div id="reportPreviewContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download</button>
                <button class="btn" onclick="copyReportContent()">ðŸ“‹ Copy</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allTasks = [];
        let filteredTasks = [];
        let selectedTasks = new Set();
        let currentPage = 1;
        let tasksPerPage = 20;
        let currentReportPath = '';

        // Auto-refresh interval (10 seconds)
        const REFRESH_INTERVAL = 10000;
        let refreshIntervalId = null;

        // Start auto-refresh on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            startAutoRefresh();
            checkNotificationPermission();
        });

        function startAutoRefresh() {
            refreshIntervalId = setInterval(() => {
                loadDashboard();
            }, REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
            }
        }

        // Load complete dashboard data
        async function loadDashboard() {
            await Promise.all([
                loadSystemHealth(),
                loadTasks(),
                loadExecutorActivity(),
                loadReports(),
                loadAnalytics()
            ]);
            updateLastRefreshTime();
        }

        // System Health Check
        async function loadSystemHealth() {
            try {
                // Check database via task endpoint
                const taskResponse = await fetch('/AgentGarden/tasks/list?limit=1');
                const taskData = await taskResponse.json();

                updateHealthStatus('database', taskData.success, taskData.success ? 'Connected' : 'Error');

                // Check MCP server
                const mcpResponse = await fetch('/tools');
                const mcpData = await mcpResponse.json();

                updateHealthStatus('mcp', mcpData && mcpData.length > 0, mcpData ? 'Online' : 'Offline');

                // Check executor (based on recent task activity)
                if (taskData.success && taskData.tasks && taskData.tasks.length > 0) {
                    const recentInProgress = taskData.tasks.some(t => t.status === 'in_progress');
                    const recentCompleted = taskData.tasks.filter(t => t.status === 'completed');

                    if (recentInProgress) {
                        updateHealthStatus('executor', true, 'Running');
                    } else if (recentCompleted.length > 0) {
                        const lastCompleted = new Date(recentCompleted[0].updated_at);
                        const minutesAgo = Math.floor((Date.now() - lastCompleted) / 60000);
                        updateHealthStatus('executor', minutesAgo < 10, minutesAgo < 10 ? 'Active' : `Idle (${minutesAgo}m ago)`);
                    } else {
                        updateHealthStatus('executor', false, 'Unknown');
                    }
                } else {
                    updateHealthStatus('executor', false, 'Unknown');
                }
            } catch (error) {
                console.error('Error checking system health:', error);
            }
        }

        function updateHealthStatus(component, isOnline, statusText) {
            const statusEl = document.getElementById(`status-${component}`);
            const textEl = document.getElementById(`${component}-status`);

            if (statusEl) {
                statusEl.className = 'health-status ' + (isOnline ? 'status-online' : 'status-offline');
            }
            if (textEl) {
                textEl.textContent = statusText;
            }
        }

        function updateLastRefreshTime() {
            const now = new Date();
            document.getElementById('last-refresh').textContent = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // Load tasks from API
        async function loadTasks() {
            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=1000');
                const data = await response.json();

                if (data.success) {
                    allTasks = data.tasks || [];
                    filteredTasks = [...allTasks];

                    // Apply current filters
                    filterTasks();

                    // Update stats
                    updateTaskStats();
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
                showToast('Error loading tasks', 'error');
            }
        }

        function updateTaskStats() {
            const stats = {
                total: allTasks.length,
                pending: allTasks.filter(t => t.status === 'pending').length,
                in_progress: allTasks.filter(t => t.status === 'in_progress').length,
                completed: allTasks.filter(t => t.status === 'completed').length,
                failed: allTasks.filter(t => t.status === 'failed').length
            };

            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-pending').textContent = stats.pending;
            document.getElementById('stat-progress').textContent = stats.in_progress;
            document.getElementById('stat-completed').textContent = stats.completed;
            document.getElementById('stat-failed').textContent = stats.failed;
        }

        function filterTasks() {
            const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterType').value;

            filteredTasks = allTasks.filter(task => {
                const matchesSearch = !searchTerm ||
                    task.id.toString().includes(searchTerm) ||
                    (task.task_json?.description || '').toLowerCase().includes(searchTerm) ||
                    (task.task_json?.prompt || '').toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || task.status === statusFilter;
                const matchesType = !typeFilter || task.task_type === typeFilter;

                return matchesSearch && matchesStatus && matchesType;
            });

            currentPage = 1;
            renderTaskList();
        }

        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            const startIndex = (currentPage - 1) * tasksPerPage;
            const endIndex = startIndex + tasksPerPage;
            const pageTasks = filteredTasks.slice(startIndex, endIndex);

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ“­</div>
                        <div class="empty-text">No tasks found matching your filters</div>
                    </div>
                `;
                updatePagination('taskPagination', 0);
                return;
            }

            taskList.innerHTML = pageTasks.map(task => {
                const isSelected = selectedTasks.has(task.id);
                return `
                    <div class="task-item ${isSelected ? 'selected' : ''}" onclick="viewTaskDetails(${task.id})">
                        <div class="task-header">
                            <div class="task-header-left">
                                <input
                                    type="checkbox"
                                    class="task-checkbox"
                                    ${isSelected ? 'checked' : ''}
                                    onclick="event.stopPropagation(); toggleTaskSelection(${task.id})"
                                />
                                <span class="task-id">#${task.id}</span>
                            </div>
                            <span class="task-status status-${task.status}">${task.status.replace('_', ' ')}</span>
                        </div>
                        <div class="task-type">${formatAgentType(task.task_type || 'General Task')}</div>
                        <div class="task-description">${truncate(task.task_json?.description || task.task_json?.prompt || 'No description', 100)}</div>
                        <div class="task-meta">
                            <span>ðŸ“… ${formatDateTime(task.created_at)}</span>
                            ${task.result_summary ? `<span>ðŸ“Š Report generated</span>` : ''}
                            ${task.schedule_cron ? `<span>ðŸ”„ Scheduled: ${task.schedule_cron}</span>` : ''}
                        </div>
                        <div class="task-actions" onclick="event.stopPropagation()">
                            <button class="task-btn view" onclick="viewTaskDetails(${task.id})">ðŸ‘ï¸ View</button>
                            ${task.status === 'failed' || task.status === 'completed' ?
                                `<button class="task-btn retry" onclick="retryTask(${task.id})">â™»ï¸ Retry</button>` : ''}
                            ${task.status === 'pending' ?
                                `<button class="task-btn delete" onclick="deleteTask(${task.id})">â¸ï¸ Cancel</button>` : ''}
                            <button class="task-btn delete" onclick="deleteTask(${task.id})">ðŸ—‘ï¸ Delete</button>
                        </div>
                    </div>
                `;
            }).join('');

            updatePagination('taskPagination', filteredTasks.length);
            updateBulkActionsBar();
        }

        function toggleTaskSelection(taskId) {
            if (selectedTasks.has(taskId)) {
                selectedTasks.delete(taskId);
            } else {
                selectedTasks.add(taskId);
            }
            renderTaskList();
        }

        function updateBulkActionsBar() {
            const bar = document.getElementById('bulkActionsBar');
            const count = document.getElementById('selectedCount');

            count.textContent = selectedTasks.size;

            if (selectedTasks.size > 0) {
                bar.classList.add('active');
            } else {
                bar.classList.remove('active');
            }
        }

        function clearSelection() {
            selectedTasks.clear();
            renderTaskList();
        }

        async function bulkDelete() {
            if (!confirm(`Delete ${selectedTasks.size} selected tasks?`)) return;

            const promises = Array.from(selectedTasks).map(id => deleteTask(id, false));
            await Promise.all(promises);

            selectedTasks.clear();
            showToast('Tasks deleted successfully', 'success');
            loadTasks();
        }

        async function bulkRetry() {
            const promises = Array.from(selectedTasks).map(id => retryTask(id, false));
            await Promise.all(promises);

            selectedTasks.clear();
            showToast('Tasks queued for retry', 'success');
            loadTasks();
        }

        function updatePagination(containerId, totalItems) {
            const container = document.getElementById(containerId);
            const totalPages = Math.ceil(totalItems / tasksPerPage);

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = `
                <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}"
                        onclick="changePage(${currentPage - 1})"
                        ${currentPage === 1 ? 'disabled' : ''}>
                    â† Prev
                </button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}"
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span style="padding: 0.5rem;">...</span>`;
                }
            }

            html += `
                <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}"
                        onclick="changePage(${currentPage + 1})"
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    Next â†’
                </button>
            `;

            container.innerHTML = html;
        }

        function changePage(page) {
            currentPage = page;
            renderTaskList();
        }

        // View task details in modal
        function viewTaskDetails(taskId) {
            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;

            const content = `
                <div class="modal-section">
                    <div class="modal-section-title">Task Information</div>
                    <div class="modal-data">Task ID: #${task.id}
Status: ${task.status}
Type: ${task.task_type || 'General'}
Created: ${formatDateTime(task.created_at)}
Updated: ${formatDateTime(task.updated_at)}
Created By: ${task.created_by || 'Unknown'}
${task.schedule_cron ? 'Schedule: ' + task.schedule_cron : ''}</div>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">Task Prompt</div>
                    <div class="modal-data">${task.task_json?.prompt || task.task_json?.description || 'No prompt provided'}</div>
                </div>

                ${task.result_summary ? `
                <div class="modal-section">
                    <div class="modal-section-title">Result Summary</div>
                    <div class="modal-data">${task.result_summary}</div>
                </div>
                ` : ''}

                ${task.tool_usage && task.tool_usage.length > 0 ? `
                <div class="modal-section">
                    <div class="modal-section-title">ðŸ”§ Tools Used (${task.tool_usage.length} calls)</div>
                    <div class="modal-data">
                        ${formatToolBadges(task.tool_usage)}
                    </div>
                </div>
                ` : ''}

                ${task.result_path ? `
                <div class="modal-section">
                    <div class="modal-section-title">Report Path</div>
                    <div class="modal-data">${task.result_path}</div>
                </div>
                ` : ''}

                ${task.error_log ? `
                <div class="modal-section">
                    <div class="modal-section-title">Error Log</div>
                    <div class="modal-data" style="color: var(--neon-red);">${task.error_log}</div>
                </div>
                ` : ''}

                <div class="modal-section">
                    <div class="modal-section-title">Full Task JSON</div>
                    <div class="modal-data">${JSON.stringify(task.task_json, null, 2)}</div>
                </div>

                <div class="modal-buttons">
                    ${task.status === 'failed' || task.status === 'completed' ?
                        `<button class="btn btn-primary" onclick="retryTask(${task.id}); closeTaskDetailModal();">â™»ï¸ Retry Task</button>` : ''}
                    <button class="btn" onclick="deleteTask(${task.id}); closeTaskDetailModal();">ðŸ—‘ï¸ Delete Task</button>
                    <button class="btn" onclick="closeTaskDetailModal()">Close</button>
                </div>
            `;

            document.getElementById('taskDetailContent').innerHTML = content;
            document.getElementById('taskDetailModal').classList.add('active');
        }

        function closeTaskDetailModal() {
            document.getElementById('taskDetailModal').classList.remove('active');
        }

        async function retryTask(taskId, showNotification = true) {
            try {
                const task = allTasks.find(t => t.id === taskId);
                if (!task) return;

                // Create new task with same parameters
                const payload = {
                    task_type: task.task_type,
                    task_json: task.task_json,
                    created_by: 'retry'
                };

                if (task.schedule_cron) {
                    payload.schedule_cron = task.schedule_cron;
                }

                const response = await fetch('/AgentGarden/tasks/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success && showNotification) {
                    showToast(`Task #${result.task_id} created (retry of #${taskId})`, 'success');
                    loadTasks();
                }
            } catch (error) {
                console.error('Error retrying task:', error);
                if (showNotification) {
                    showToast('Failed to retry task', 'error');
                }
            }
        }

        async function deleteTask(taskId, showNotification = true) {
            // Note: Backend endpoint for task deletion not implemented yet
            // This would need to be added to unified_app.py
            if (showNotification) {
                showToast('Delete endpoint not yet implemented', 'info');
            }
            console.log('Delete task:', taskId);
        }

        // Load executor activity
        async function loadExecutorActivity() {
            const activityFeed = document.getElementById('activityFeed');

            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=15');
                const data = await response.json();

                if (data.success && data.tasks && data.tasks.length > 0) {
                    const activities = data.tasks.map(task => {
                        const time = new Date(task.updated_at || task.created_at);
                        const timeStr = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                        let action = 'Task created';
                        let indicator = 'polling';

                        if (task.status === 'in_progress') {
                            action = 'Executing task';
                            indicator = 'executing';
                        } else if (task.status === 'completed') {
                            action = 'Task completed';
                            indicator = 'completed';
                        } else if (task.status === 'failed') {
                            action = 'Task failed';
                            indicator = 'failed';
                        }

                        // Format tool usage badges with beautiful categorized display
                        const toolBadges = task.tool_usage && task.tool_usage.length > 0
                            ? formatToolBadgesCompact(task.tool_usage)
                            : '';

                        return `
                            <div class="activity-item">
                                <div class="activity-indicator indicator-${indicator}"></div>
                                <div class="activity-time">${timeStr}</div>
                                <div class="activity-content">
                                    <div class="activity-action">${action}</div>
                                    <div class="activity-details">Task #${task.id}: ${formatAgentType(task.task_type || 'General')}${toolBadges}</div>
                                </div>
                            </div>
                        `;
                    });

                    activityFeed.innerHTML = activities.join('');
                } else {
                    activityFeed.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">ðŸ’¤</div>
                            <div class="empty-text">No recent executor activity</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }

        // Get format from file extension
        function getFormatFromPath(path) {
            if (!path) return 'md';
            const ext = path.split('.').pop().toLowerCase();
            const formatMap = {
                'md': 'md',
                'csv': 'csv',
                'xlsx': 'xlsx',
                'xls': 'xlsx',
                'json': 'json',
                'pdf': 'pdf'
            };
            return formatMap[ext] || 'md';
        }

        // Get format display info
        function getFormatInfo(format) {
            const formats = {
                'md': { icon: 'ðŸ“„', label: 'MD', color: '#9ca3af' },
                'csv': { icon: 'ðŸ“Š', label: 'CSV', color: '#22c55e' },
                'xlsx': { icon: 'ðŸ“‘', label: 'XLSX', color: '#16a34a' },
                'json': { icon: 'ðŸ—‚ï¸', label: 'JSON', color: '#f59e0b' },
                'pdf': { icon: 'ðŸ“•', label: 'PDF', color: '#ef4444' }
            };
            return formats[format] || formats['md'];
        }

        // Load reports from API
        async function loadReports() {
            const reportsGrid = document.getElementById('reportsGrid');

            try {
                const response = await fetch('/AgentGarden/api/reports/list?limit=50');
                const data = await response.json();

                if (data.success) {
                    const reports = data.reports || [];

                    if (reports.length === 0) {
                        reportsGrid.innerHTML = `
                            <div class="empty-state" style="grid-column: 1 / -1;">
                                <div class="empty-icon">ðŸ“Š</div>
                                <div class="empty-text">No reports yet. Claude will generate reports here once tasks are completed.</div>
                            </div>
                        `;
                    } else {
                        reportsGrid.innerHTML = reports.map(report => {
                            const agentEmojis = {
                                'inventory_intelligence': 'ðŸ“¦',
                                'sales_analysis': 'ðŸ’°',
                                'customer_insights': 'ðŸ‘¥',
                                'product_performance': 'ðŸ“ˆ',
                                'general_report': 'ðŸ“',
                                'unknown': 'ðŸ“„'
                            };

                            const emoji = agentEmojis[report.agent_type] || 'ðŸ“„';
                            const sizeKB = (report.size / 1024).toFixed(1);
                            const format = getFormatFromPath(report.path);
                            const formatInfo = getFormatInfo(format);

                            return `
                                <div class="report-card" onclick="viewReportPreview('${report.path}', '${report.title}')">
                                    <div class="report-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                        <div class="report-icon">${emoji}</div>
                                        <span class="report-format-badge format-${format}" title="${formatInfo.label} format">
                                            ${formatInfo.icon} ${formatInfo.label}
                                        </span>
                                    </div>
                                    <div class="report-title">${report.title}</div>
                                    <div class="report-meta">
                                        <span>${formatDateTime(report.created_at)}</span>
                                        <span>${sizeKB} KB</span>
                                    </div>
                                    <div class="report-summary">${report.summary || `${report.agent_type.replace(/_/g, ' ')} report`}</div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        // View report preview in modal - handles different formats
        async function viewReportPreview(reportPath, reportTitle) {
            try {
                currentReportPath = reportPath;
                const format = getFormatFromPath(reportPath);
                const modal = document.getElementById('reportPreviewModal');
                const content = document.getElementById('reportPreviewContent');
                const buttons = document.querySelector('#reportPreviewModal .modal-buttons');

                document.getElementById('reportModalTitle').textContent = reportTitle;

                if (format === 'md') {
                    // Markdown: show preview
                    const response = await fetch(`/AgentGarden/api/reports/view/${reportPath}`);
                    const markdown = await response.text();
                    content.innerHTML = `
                        <div class="modal-data" style="max-height: 500px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; font-size: 13px; line-height: 1.5; padding: 1rem; background: #1a1a2e; border-radius: 8px;">${escapeHtml(markdown)}</div>
                    `;
                    buttons.innerHTML = `
                        <button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download</button>
                        <button class="btn" onclick="copyReportContent()">ðŸ“‹ Copy</button>
                    `;
                } else if (format === 'csv') {
                    // CSV: show table preview
                    content.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="spinner"></div> Loading preview...</div>';
                    modal.classList.add('active');

                    const response = await fetch(`/AgentGarden/api/reports/view/${reportPath}?preview=true&rows=25`);
                    const data = await response.json();

                    if (data.success) {
                        const tableHtml = buildCsvPreviewTable(data.headers, data.rows);
                        content.innerHTML = `
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: #22c55e; font-weight: 600;">ðŸ“Š CSV Preview (${data.preview_count} of ${data.total_rows.toLocaleString()} rows)</span>
                                </div>
                                <div style="background: #0d1117; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                                    <div style="max-height: 400px; overflow: auto;">
                                        ${tableHtml}
                                    </div>
                                </div>
                            </div>
                            <div style="background: #1e293b; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 0.5rem;">ðŸ“ Local File Path (click to copy):</div>
                                <code onclick="copyToClipboard('${data.local_path}')" style="cursor: pointer; display: block; padding: 0.5rem; background: #0f172a; border-radius: 4px; font-size: 11px; color: #60a5fa; word-break: break-all;">${data.local_path}</code>
                            </div>
                        `;
                        buttons.innerHTML = `
                            <button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download CSV</button>
                            <button class="btn" onclick="copyFilePath('${data.local_path}')">ðŸ“ Copy Path</button>
                            <button class="btn" onclick="openInFinder('${data.local_path}')">ðŸ—‚ï¸ Reveal in Finder</button>
                        `;
                    } else if (data.error === 'local_file_only') {
                        // File only available on local OneDrive
                        content.innerHTML = `
                            <div style="text-align: center; padding: 1.5rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“Š</div>
                                <div style="font-size: 1.1rem; font-weight: 600; color: #f59e0b; margin-bottom: 0.5rem;">CSV File on OneDrive</div>
                                <div style="color: #94a3b8; font-size: 13px; margin-bottom: 1rem;">${data.message}</div>
                            </div>
                            <div style="background: #1e293b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <div style="color: #94a3b8; font-size: 12px; margin-bottom: 0.5rem;">ðŸ“ File Location (click to copy):</div>
                                <code onclick="copyToClipboard('${data.expected_path}')" style="cursor: pointer; display: block; padding: 0.5rem; background: #0f172a; border-radius: 4px; font-size: 11px; color: #60a5fa; word-break: break-all;">${data.expected_path}</code>
                            </div>
                            ${data.summary ? `
                            <div style="background: #0f172a; padding: 1rem; border-radius: 8px; border: 1px solid #30363d;">
                                <div style="color: #22c55e; font-size: 12px; font-weight: 600; margin-bottom: 0.5rem;">ðŸ“‹ Report Summary:</div>
                                <div style="color: #c9d1d9; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${escapeHtml(data.summary)}</div>
                            </div>
                            ` : ''}
                        `;
                        buttons.innerHTML = `
                            <button class="btn btn-primary" onclick="copyFilePath('${data.expected_path}')">ðŸ“ Copy Path</button>
                            <button class="btn" onclick="closeReportPreviewModal()">Close</button>
                        `;
                    } else {
                        content.innerHTML = `<div style="color: #ef4444; padding: 2rem; text-align: center;">Error: ${data.error || 'Failed to load preview'}</div>`;
                    }
                } else if (format === 'xlsx') {
                    // Excel: can't preview, show download option
                    const infoResponse = await fetch(`/AgentGarden/api/reports/info/${reportPath}`);
                    const info = await infoResponse.json();

                    content.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ“‘</div>
                            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Excel File</div>
                            <div style="color: #94a3b8; margin-bottom: 1rem;">${info.size_human || 'Unknown size'}</div>
                            <div style="color: #64748b; font-size: 13px;">Excel files cannot be previewed in browser.<br>Download or open in OneDrive to view.</div>
                        </div>
                        ${info.success ? `
                        <div style="background: #1e293b; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <div style="color: #94a3b8; font-size: 12px; margin-bottom: 0.5rem;">ðŸ“ Local File Path (click to copy):</div>
                            <code onclick="copyToClipboard('${info.local_path}')" style="cursor: pointer; display: block; padding: 0.5rem; background: #0f172a; border-radius: 4px; font-size: 11px; color: #60a5fa; word-break: break-all;">${info.local_path}</code>
                        </div>
                        ` : ''}
                    `;
                    buttons.innerHTML = `
                        <button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download Excel</button>
                        ${info.success ? `<button class="btn" onclick="copyFilePath('${info.local_path}')">ðŸ“ Copy Path</button>` : ''}
                    `;
                } else if (format === 'json') {
                    // JSON: show formatted preview
                    const response = await fetch(`/AgentGarden/api/reports/view/${reportPath}?preview=true`);
                    const data = await response.json();

                    if (data.success) {
                        content.innerHTML = `
                            <div style="max-height: 500px; overflow-y: auto; background: #0f172a; border-radius: 8px; padding: 1rem;">
                                <pre style="margin: 0; font-size: 12px; color: #e2e8f0;">${escapeHtml(JSON.stringify(data.data, null, 2))}</pre>
                            </div>
                        `;
                    }
                    buttons.innerHTML = `
                        <button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download JSON</button>
                        <button class="btn" onclick="copyReportContent()">ðŸ“‹ Copy</button>
                    `;
                } else {
                    // Unknown format: offer download
                    content.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ“„</div>
                            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">${format.toUpperCase()} File</div>
                            <div style="color: #64748b; font-size: 13px;">This file type cannot be previewed.<br>Click download to save the file.</div>
                        </div>
                    `;
                    buttons.innerHTML = `<button class="btn btn-primary" onclick="downloadCurrentReport()">ðŸ’¾ Download</button>`;
                }

                modal.classList.add('active');
            } catch (error) {
                console.error('Error loading report:', error);
                showToast('Failed to load report: ' + error.message, 'error');
            }
        }

        // Build HTML table from CSV data
        function buildCsvPreviewTable(headers, rows) {
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
            html += '<thead><tr>';
            headers.forEach(h => {
                html += `<th style="padding: 8px 12px; text-align: left; background: #161b22; color: #58a6ff; border-bottom: 1px solid #30363d; white-space: nowrap;">${escapeHtml(h)}</th>`;
            });
            html += '</tr></thead><tbody>';
            rows.forEach((row, i) => {
                const bgColor = i % 2 === 0 ? '#0d1117' : '#161b22';
                html += `<tr style="background: ${bgColor};">`;
                row.forEach(cell => {
                    html += `<td style="padding: 6px 12px; border-bottom: 1px solid #21262d; color: #c9d1d9; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${escapeHtml(cell || '')}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            return html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function closeReportPreviewModal() {
            document.getElementById('reportPreviewModal').classList.remove('active');
        }

        function downloadCurrentReport() {
            if (!currentReportPath) return;
            // Trigger download
            const link = document.createElement('a');
            link.href = `/AgentGarden/api/reports/view/${currentReportPath}`;
            link.download = currentReportPath.split('/').pop();
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('Download started', 'success');
        }

        function copyReportContent() {
            const content = document.getElementById('reportPreviewContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                showToast('Report content copied to clipboard', 'success');
            });
        }

        function copyFilePath(path) {
            navigator.clipboard.writeText(path).then(() => {
                showToast('File path copied to clipboard', 'success');
            });
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            });
        }

        function openInFinder(path) {
            // This only works locally - show instructions for cloud
            showToast('Open Finder and navigate to: ' + path.substring(0, 50) + '...', 'info');
            copyFilePath(path);
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/AgentGarden/tasks/list?limit=1000');
                const data = await response.json();

                if (data.success) {
                    const tasks = data.tasks || [];

                    // Last 7 days tasks
                    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    const last7Days = tasks.filter(t => new Date(t.created_at) > sevenDaysAgo);

                    const completed7d = last7Days.filter(t => t.status === 'completed').length;
                    const total7d = last7Days.length;
                    const successRate = total7d > 0 ? Math.round((completed7d / total7d) * 100) : 0;

                    document.getElementById('analytics-completion-rate').textContent = successRate + '%';

                    // Average execution time (mock data - would need started_at/completed_at in DB)
                    document.getElementById('analytics-avg-time').textContent = '45s';

                    // Tasks today
                    const today = new Date().toDateString();
                    const tasksToday = tasks.filter(t => new Date(t.created_at).toDateString() === today).length;
                    document.getElementById('analytics-today').textContent = tasksToday;

                    // Tasks this week
                    const weekStart = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    const tasksWeek = tasks.filter(t => new Date(t.created_at) > weekStart).length;
                    document.getElementById('analytics-week').textContent = tasksWeek;
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Format picker selection
        function selectFormat(format) {
            // Update hidden input
            document.getElementById('outputFormat').value = format;

            // Update visual selection
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.format-option[data-format="${format}"]`).classList.add('selected');
        }

        // Create new task via form
        async function createTask(event) {
            event.preventDefault();

            const taskType = document.getElementById('taskType').value;
            const taskPrompt = document.getElementById('taskPrompt').value;
            const scheduleCron = document.getElementById('scheduleCron').value;
            const outputFormat = document.getElementById('outputFormat').value;

            const payload = {
                task_type: taskType,
                task_json: {
                    agent_type: taskType,
                    prompt: taskPrompt,
                    description: taskPrompt
                },
                output_format: outputFormat,
                created_by: 'dashboard'
            };

            if (scheduleCron.trim()) {
                payload.schedule_cron = scheduleCron.trim();
            }

            try {
                const response = await fetch('/AgentGarden/tasks/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`Task #${result.task_id} created successfully! (${outputFormat.toUpperCase()})`, 'success');

                    // Reset form
                    document.getElementById('taskType').value = '';
                    document.getElementById('taskPrompt').value = '';
                    document.getElementById('scheduleCron').value = '';

                    // Reset schedule picker to "Run Once"
                    selectSchedulePreset('');
                    document.getElementById('scheduleHour').value = '9';
                    document.getElementById('scheduleMinute').value = '0';
                    document.getElementById('scheduleAmPm').value = 'AM';
                    document.querySelectorAll('.day-checkbox input').forEach(cb => cb.checked = false);
                    if (document.getElementById('scheduleCronCustom')) {
                        document.getElementById('scheduleCronCustom').value = '';
                    }

                    // Reset format to default (md)
                    selectFormat('md');

                    // Refresh tasks
                    loadTasks();
                } else {
                    showToast(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error creating task:', error);
                showToast('Failed to create task', 'error');
            }
        }

        // Schedule Picker State
        let currentScheduleType = '';  // '', 'daily', 'weekly', 'hourly', 'custom'

        // Select schedule preset
        function selectSchedulePreset(type) {
            currentScheduleType = type;

            // Update preset button styles
            document.querySelectorAll('.schedule-preset').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.schedule === type) {
                    btn.classList.add('selected');
                }
            });

            // Show/hide relevant pickers
            const timePicker = document.getElementById('scheduleTimePicker');
            const dayPicker = document.getElementById('scheduleDayPicker');
            const customInput = document.getElementById('scheduleCustomInput');
            const preview = document.getElementById('schedulePreview');

            // Hide all first
            timePicker.style.display = 'none';
            dayPicker.style.display = 'none';
            customInput.style.display = 'none';
            preview.style.display = 'none';

            // Show relevant sections based on type
            if (type === 'daily') {
                timePicker.style.display = 'block';
            } else if (type === 'weekly') {
                timePicker.style.display = 'block';
                dayPicker.style.display = 'block';
            } else if (type === 'custom') {
                customInput.style.display = 'block';
            }

            // Update the schedule preview and hidden field
            updateSchedulePreview();
        }

        // Update schedule preview and generate cron expression
        function updateSchedulePreview() {
            const preview = document.getElementById('schedulePreview');
            const previewText = document.getElementById('schedulePreviewText');
            const cronField = document.getElementById('scheduleCron');

            let cronExpression = '';
            let humanReadable = '';

            if (currentScheduleType === '') {
                // Run once - no schedule
                cronField.value = '';
                preview.style.display = 'none';
                return;
            }

            if (currentScheduleType === 'hourly') {
                cronExpression = '0 * * * *';
                humanReadable = 'Will run every hour at minute 0';
            }

            if (currentScheduleType === 'daily' || currentScheduleType === 'weekly') {
                const hour24 = getSelectedHour24();
                const minute = document.getElementById('scheduleMinute').value;
                const timeStr = formatTime12h(hour24, minute);

                if (currentScheduleType === 'daily') {
                    cronExpression = `${minute} ${hour24} * * *`;
                    humanReadable = `Will run every day at ${timeStr}`;
                } else {
                    // Weekly - get selected days
                    const selectedDays = getSelectedDays();
                    if (selectedDays.length === 0) {
                        cronField.value = '';
                        preview.style.display = 'none';
                        return;
                    }
                    const dayOfWeek = selectedDays.join(',');
                    cronExpression = `${minute} ${hour24} * * ${dayOfWeek}`;
                    humanReadable = `Will run ${formatDayNames(selectedDays)} at ${timeStr}`;
                }
            }

            if (currentScheduleType === 'custom') {
                const customCron = document.getElementById('scheduleCronCustom').value.trim();
                if (!customCron) {
                    cronField.value = '';
                    preview.style.display = 'none';
                    return;
                }
                // Validate cron format (5 parts)
                const parts = customCron.split(/\s+/);
                if (parts.length !== 5) {
                    cronField.value = '';
                    preview.style.display = 'none';
                    return;
                }
                cronExpression = customCron;
                humanReadable = `Custom schedule: ${customCron}`;
            }

            // Update hidden field and preview
            cronField.value = cronExpression;
            previewText.textContent = humanReadable;
            preview.style.display = 'flex';
        }

        // Get selected hour in 24h format
        function getSelectedHour24() {
            let hour = parseInt(document.getElementById('scheduleHour').value);
            const ampm = document.getElementById('scheduleAmPm').value;

            // Convert 12-hour to 24-hour format
            if (ampm === 'AM') {
                // 12 AM = 0, 1-11 AM = 1-11
                if (hour === 12) hour = 0;
            } else {
                // 12 PM = 12, 1-11 PM = 13-23
                if (hour !== 12) hour += 12;
            }
            return hour;
        }

        // Format time in 12h format
        function formatTime12h(hour24, minute) {
            let hour12 = hour24 % 12;
            if (hour12 === 0) hour12 = 12;
            const ampm = hour24 < 12 ? 'AM' : 'PM';
            const minStr = minute.toString().padStart(2, '0');
            return `${hour12}:${minStr} ${ampm}`;
        }

        // Get selected days from checkboxes
        function getSelectedDays() {
            const checkboxes = document.querySelectorAll('.day-checkbox input:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Format day names for display
        function formatDayNames(dayNumbers) {
            const dayNames = {
                '0': 'Sunday', '1': 'Monday', '2': 'Tuesday', '3': 'Wednesday',
                '4': 'Thursday', '5': 'Friday', '6': 'Saturday'
            };

            if (dayNumbers.length === 7) return 'every day';
            if (dayNumbers.length === 5 && !dayNumbers.includes('0') && !dayNumbers.includes('6')) {
                return 'weekdays';
            }
            if (dayNumbers.length === 2 && dayNumbers.includes('0') && dayNumbers.includes('6')) {
                return 'weekends';
            }

            const names = dayNumbers.map(d => dayNames[d]);
            if (names.length === 1) return `every ${names[0]}`;
            if (names.length === 2) return `every ${names[0]} and ${names[1]}`;
            return `every ${names.slice(0, -1).join(', ')} and ${names[names.length - 1]}`;
        }

        // Legacy function for backwards compatibility (not used in new UI)
        function validateCron(cronExpression) {
            // This function is kept for any external calls but is not used in the new UI
            const preview = document.getElementById('cronPreview');
            if (preview) {
                preview.classList.remove('active');
            }
        }

        // Export functions
        function exportTasks() {
            const csv = convertTasksToCSV(allTasks);
            downloadCSV(csv, 'tasks-export.csv');
            showToast('Tasks exported to CSV', 'success');
        }

        function convertTasksToCSV(tasks) {
            const headers = ['ID', 'Status', 'Type', 'Description', 'Created', 'Updated', 'Schedule'];
            const rows = tasks.map(t => [
                t.id,
                t.status,
                t.task_type || 'General',
                (t.task_json?.description || t.task_json?.prompt || '').replace(/"/g, '""'),
                t.created_at,
                t.updated_at,
                t.schedule_cron || ''
            ]);

            return [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportReports() {
            showToast('Export all reports feature coming soon', 'info');
        }

        // Notifications
        function checkNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                // Don't auto-request, wait for user action
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                info: 'â„¹ï¸'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || 'â„¹ï¸'}</div>
                <div class="toast-message">${message}</div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Refresh functions
        function refreshTasks() {
            loadTasks();
            showToast('Tasks refreshed', 'info');
        }

        function refreshReports() {
            loadReports();
            showToast('Reports refreshed', 'info');
        }

        // Utility functions
        function formatDateTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function truncate(str, maxLength) {
            if (!str) return '';
            return str.length > maxLength ? str.substring(0, maxLength) + '...' : str;
        }

        function formatAgentType(type) {
            const emojis = {
                'inventory_intelligence': 'ðŸ“¦',
                'sales_analysis': 'ðŸ’°',
                'customer_insights': 'ðŸ‘¥',
                'product_performance': 'ðŸ“ˆ',
                'general_report': 'ðŸ“'
            };
            const emoji = emojis[type] || 'ðŸ“';
            const formatted = type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            return `${emoji} ${formatted}`;
        }

        // ============================================================================
        // TOOL USAGE FORMATTING SYSTEM
        // Beautiful, categorized tool badges with icons and colors
        // ============================================================================

        const TOOL_CONFIG = {
            // File Operations - Blue
            'Read': { icon: 'ðŸ“–', category: 'file', color: '#3b82f6', name: 'Read' },
            'Write': { icon: 'âœï¸', category: 'file', color: '#3b82f6', name: 'Write' },
            'Edit': { icon: 'ðŸ“', category: 'file', color: '#3b82f6', name: 'Edit' },
            'Glob': { icon: 'ðŸ”', category: 'file', color: '#3b82f6', name: 'Glob' },
            'Grep': { icon: 'ðŸ”Ž', category: 'file', color: '#3b82f6', name: 'Grep' },
            'NotebookEdit': { icon: 'ðŸ““', category: 'file', color: '#3b82f6', name: 'Notebook' },

            // System Operations - Purple
            'Bash': { icon: 'âš¡', category: 'system', color: '#a855f7', name: 'Bash' },
            'Task': { icon: 'ðŸ¤–', category: 'system', color: '#a855f7', name: 'Agent' },
            'TaskOutput': { icon: 'ðŸ“¤', category: 'system', color: '#a855f7', name: 'Output' },
            'KillShell': { icon: 'ðŸ›‘', category: 'system', color: '#a855f7', name: 'Kill' },
            'LSP': { icon: 'ðŸ”—', category: 'system', color: '#a855f7', name: 'LSP' },

            // Web Operations - Orange
            'WebFetch': { icon: 'ðŸŒ', category: 'web', color: '#f97316', name: 'Fetch' },
            'WebSearch': { icon: 'ðŸ”Ž', category: 'web', color: '#f97316', name: 'Search' },

            // Database (MCP TiDB) - Green
            'mcp__tidb-mcp__query': { icon: 'ðŸ—„ï¸', category: 'database', color: '#22c55e', name: 'DB Query' },
            'mcp__tidb-mcp__describe_table': { icon: 'ðŸ“‹', category: 'database', color: '#22c55e', name: 'Schema' },
            'mcp__tidb-mcp__list_tables': { icon: 'ðŸ“‘', category: 'database', color: '#22c55e', name: 'Tables' },
            'mcp__tidb-mcp__today_orders': { icon: 'ðŸ“¦', category: 'database', color: '#22c55e', name: 'Orders' },
            'mcp__tidb-mcp__recent_orders': { icon: 'ðŸ•', category: 'database', color: '#22c55e', name: 'Recent' },
            'mcp__tidb-mcp__order_details': { icon: 'ðŸ”', category: 'database', color: '#22c55e', name: 'Details' },

            // Browser (MCP Playwright) - Pink
            'mcp__playwright__browser_snapshot': { icon: 'ðŸ“¸', category: 'browser', color: '#ec4899', name: 'Snapshot' },
            'mcp__playwright__browser_click': { icon: 'ðŸ‘†', category: 'browser', color: '#ec4899', name: 'Click' },
            'mcp__playwright__browser_type': { icon: 'âŒ¨ï¸', category: 'browser', color: '#ec4899', name: 'Type' },
            'mcp__playwright__browser_navigate': { icon: 'ðŸ§­', category: 'browser', color: '#ec4899', name: 'Navigate' },
            'mcp__playwright__browser_take_screenshot': { icon: 'ðŸ“·', category: 'browser', color: '#ec4899', name: 'Screenshot' },
            'mcp__playwright__browser_evaluate': { icon: 'âš™ï¸', category: 'browser', color: '#ec4899', name: 'Evaluate' },
            'mcp__playwright__browser_wait_for': { icon: 'â³', category: 'browser', color: '#ec4899', name: 'Wait' },

            // Render MCP - Teal
            'mcp__render__list_services': { icon: 'â˜ï¸', category: 'render', color: '#14b8a6', name: 'Services' },
            'mcp__render__get_service': { icon: 'ðŸ”', category: 'render', color: '#14b8a6', name: 'Service' },
            'mcp__render__list_logs': { icon: 'ðŸ“œ', category: 'render', color: '#14b8a6', name: 'Logs' },
            'mcp__render__get_metrics': { icon: 'ðŸ“Š', category: 'render', color: '#14b8a6', name: 'Metrics' },

            // IDE MCP - Yellow
            'mcp__ide__getDiagnostics': { icon: 'ðŸ©º', category: 'ide', color: '#eab308', name: 'Diagnostics' },
            'mcp__ide__executeCode': { icon: 'â–¶ï¸', category: 'ide', color: '#eab308', name: 'Execute' },

            // Planning & Interaction - Cyan
            'TodoWrite': { icon: 'âœ…', category: 'planning', color: '#06b6d4', name: 'Todo' },
            'AskUserQuestion': { icon: 'â“', category: 'planning', color: '#06b6d4', name: 'Ask' },
            'EnterPlanMode': { icon: 'ðŸ“‹', category: 'planning', color: '#06b6d4', name: 'Plan' },
            'ExitPlanMode': { icon: 'âœ”ï¸', category: 'planning', color: '#06b6d4', name: 'Done' },
            'Skill': { icon: 'ðŸŽ¯', category: 'planning', color: '#06b6d4', name: 'Skill' }
        };

        function getToolInfo(toolName) {
            // Direct match
            if (TOOL_CONFIG[toolName]) {
                return TOOL_CONFIG[toolName];
            }

            // Pattern matching for MCP tools
            if (toolName.startsWith('mcp__tidb-mcp__')) {
                const action = toolName.replace('mcp__tidb-mcp__', '');
                return { icon: 'ðŸ—„ï¸', category: 'database', color: '#22c55e', name: action.replace(/_/g, ' ') };
            }
            if (toolName.startsWith('mcp__playwright__')) {
                const action = toolName.replace('mcp__playwright__browser_', '').replace('mcp__playwright__', '');
                return { icon: 'ðŸŽ­', category: 'browser', color: '#ec4899', name: action.replace(/_/g, ' ') };
            }
            if (toolName.startsWith('mcp__render__')) {
                const action = toolName.replace('mcp__render__', '');
                return { icon: 'â˜ï¸', category: 'render', color: '#14b8a6', name: action.replace(/_/g, ' ') };
            }
            if (toolName.startsWith('mcp__ide__')) {
                const action = toolName.replace('mcp__ide__', '');
                return { icon: 'ðŸ’»', category: 'ide', color: '#eab308', name: action };
            }
            if (toolName.startsWith('mcp__')) {
                const action = toolName.split('__').pop();
                return { icon: 'ðŸ”Œ', category: 'mcp', color: '#6366f1', name: action };
            }

            // Fallback for unknown tools
            return { icon: 'ðŸ”§', category: 'other', color: '#6b7280', name: toolName };
        }

        function formatToolBadge(toolName, size = 'normal') {
            const info = getToolInfo(toolName);
            const isSmall = size === 'small';
            const padding = isSmall ? '3px 8px' : '5px 12px';
            const fontSize = isSmall ? '11px' : '12px';
            const iconSize = isSmall ? '12px' : '14px';

            return `
                <span class="tool-badge"
                      style="
                        display: inline-flex;
                        align-items: center;
                        gap: 4px;
                        background: ${info.color}20;
                        border: 1px solid ${info.color}50;
                        color: ${info.color};
                        padding: ${padding};
                        border-radius: 6px;
                        font-size: ${fontSize};
                        font-weight: 600;
                        font-family: 'JetBrains Mono', monospace;
                        white-space: nowrap;
                        transition: all 0.2s ease;
                      "
                      title="${toolName}"
                      onmouseover="this.style.background='${info.color}35'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px ${info.color}30';"
                      onmouseout="this.style.background='${info.color}20'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <span style="font-size: ${iconSize};">${info.icon}</span>
                    <span>${info.name}</span>
                </span>
            `;
        }

        function formatToolBadges(tools, size = 'normal') {
            if (!tools || tools.length === 0) return '';

            // Count tool occurrences
            const toolCounts = {};
            tools.forEach(tool => {
                toolCounts[tool] = (toolCounts[tool] || 0) + 1;
            });

            // Group by category for better organization
            const categorized = {};
            Object.keys(toolCounts).forEach(tool => {
                const info = getToolInfo(tool);
                if (!categorized[info.category]) {
                    categorized[info.category] = [];
                }
                categorized[info.category].push({ tool, count: toolCounts[tool], info });
            });

            // Render badges grouped by category
            let html = '<div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px;">';

            Object.values(categorized).flat().forEach(({ tool, count, info }) => {
                const badge = formatToolBadge(tool, size);
                if (count > 1) {
                    html += `
                        <span style="position: relative; display: inline-flex;">
                            ${badge}
                            <span style="
                                position: absolute;
                                top: -6px;
                                right: -6px;
                                background: ${info.color};
                                color: white;
                                font-size: 10px;
                                font-weight: bold;
                                min-width: 16px;
                                height: 16px;
                                border-radius: 8px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                            ">Ã—${count}</span>
                        </span>
                    `;
                } else {
                    html += badge;
                }
            });

            html += '</div>';
            return html;
        }

        // Compact version for activity feed
        function formatToolBadgesCompact(tools) {
            return formatToolBadges(tools, 'small');
        }
    </script>
</body>
</html>
